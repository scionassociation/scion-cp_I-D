<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>SCION Control Plane</title>
<meta content="Corine de Kater" name="author">
<meta content="Nicola Rustignoli" name="author">
<meta content="Samuel Hitz" name="author">
<meta content="
       This document describes the control plane of the path-aware, inter-domain network architecture SCION (Scalability, Control, and Isolation On Next-generation networks). One of the basic characteristics of SCION is that it gives path control to SCION-capable endpoints. In fact, endpoints can choose between multiple path options, enabling the optimization of network paths. The SCION control plane is responsible for discovering these paths and making them available to the endpoints. 
       The main goal of SCION's control plane is to create and manage path segments, which can then be combined into forwarding paths to transmit packets in the data plane. This document first discusses how path exploration is realized through beaconing and how path segments are created and registered. Each SCION autonomous system (AS) can register segments according to its own policy - it is free to specify which path properties and algorithm(s) to use in the selection procedure. The document then describes the path lookup process, where endpoints obtain path segments - a fundamental building block for the construction of end-to-end paths. 
    " name="description">
<meta content="xml2rfc 3.22.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-dekater-scion-controlplane-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.22.0
    Python 3.12.3
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.2.2
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 69.5.1
    wcwidth 0.2.13
-->
<link href="draft-dekater-scion-controlplane.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">SCION CP</td>
<td class="right">July 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">de Kater, et al.</td>
<td class="center">Expires 22 January 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-dekater-scion-controlplane-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-07-21" class="published">21 July 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-01-22">22 January 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C. de Kater</div>
<div class="org">SCION Association</div>
</div>
<div class="author">
      <div class="author-name">N. Rustignoli</div>
<div class="org">SCION Association</div>
</div>
<div class="author">
      <div class="author-name">S. Hitz</div>
<div class="org">Anapaya Systems</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">SCION Control Plane</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes the control plane of the path-aware, inter-domain network architecture SCION (Scalability, Control, and Isolation On Next-generation networks). One of the basic characteristics of SCION is that it gives path control to SCION-capable endpoints. In fact, endpoints can choose between multiple path options, enabling the optimization of network paths. The SCION control plane is responsible for discovering these paths and making them available to the endpoints.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">The main goal of SCION's control plane is to create and manage path segments, which can then be combined into forwarding paths to transmit packets in the data plane. This document first discusses how path exploration is realized through beaconing and how path segments are created and registered. Each SCION autonomous system (AS) can register segments according to its own policy - it is free to specify which path properties and algorithm(s) to use in the selection procedure. The document then describes the path lookup process, where endpoints obtain path segments - a fundamental building block for the construction of end-to-end paths.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://scionassociation.github.io/scion-cp_I-D/draft-dekater-scion-controlplane.html">https://scionassociation.github.io/scion-cp_I-D/draft-dekater-scion-controlplane.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-dekater-scion-controlplane/">https://datatracker.ietf.org/doc/draft-dekater-scion-controlplane/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/scionassociation/scion-cp_I-D">https://github.com/scionassociation/scion-cp_I-D</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 22 January 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-paths-and-links" class="internal xref">Paths and Links</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.4">
                <p id="section-toc.1-1.1.2.4.1"><a href="#section-1.4" class="auto internal xref">1.4</a>.  <a href="#name-routing" class="internal xref">Routing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.4.2.1">
                    <p id="section-toc.1-1.1.2.4.2.1.1"><a href="#section-1.4.1" class="auto internal xref">1.4.1</a>.  <a href="#name-path-segments" class="internal xref">Path Segments</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.5">
                <p id="section-toc.1-1.1.2.5.1"><a href="#section-1.5" class="auto internal xref">1.5</a>.  <a href="#name-addressing" class="internal xref">Addressing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.5.2.1">
                    <p id="section-toc.1-1.1.2.5.2.1.1"><a href="#section-1.5.1" class="auto internal xref">1.5.1</a>.  <a href="#name-isd-numbers" class="internal xref">ISD Numbers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.5.2.2">
                    <p id="section-toc.1-1.1.2.5.2.2.1"><a href="#section-1.5.2" class="auto internal xref">1.5.2</a>.  <a href="#name-scion-as-numbers" class="internal xref">SCION AS Numbers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.5.2.3">
                    <p id="section-toc.1-1.1.2.5.2.3.1"><a href="#section-1.5.3" class="auto internal xref">1.5.3</a>.  <a href="#name-wildcard-addressing" class="internal xref">Wildcard Addressing</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.6">
                <p id="section-toc.1-1.1.2.6.1"><a href="#section-1.6" class="auto internal xref">1.6</a>.  <a href="#name-avoiding-circular-dependenc" class="internal xref">Avoiding Circular Dependencies and Partitioning</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.6.2.1">
                    <p id="section-toc.1-1.1.2.6.2.1.1"><a href="#section-1.6.1" class="auto internal xref">1.6.1</a>.  <a href="#name-partition-and-healing" class="internal xref">Partition and Healing</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.7">
                <p id="section-toc.1-1.1.2.7.1"><a href="#section-1.7" class="auto internal xref">1.7</a>.  <a href="#name-communication-protocol" class="internal xref">Communication Protocol</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-path-exploration-or-beaconi" class="internal xref">Path Exploration or Beaconing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-introduction-and-overview" class="internal xref">Introduction and Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1"><a href="#section-2.1.1" class="auto internal xref">2.1.1</a>.  <a href="#name-peering-links" class="internal xref">Peering Links</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.2">
                    <p id="section-toc.1-1.2.2.1.2.2.1"><a href="#section-2.1.2" class="auto internal xref">2.1.2</a>.  <a href="#name-extending-a-pcb" class="internal xref">Extending a PCB</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.3">
                    <p id="section-toc.1-1.2.2.1.2.3.1"><a href="#section-2.1.3" class="auto internal xref">2.1.3</a>.  <a href="#name-pcb-propagation-illustrated" class="internal xref">PCB Propagation - Illustrated Examples</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-path-segment-construction-b" class="internal xref">Path-Segment Construction Beacons (PCBs)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="auto internal xref">2.2.1</a>.  <a href="#name-components-of-a-pcb-in-mess" class="internal xref">Components of a PCB in Message Format</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="auto internal xref">2.2.2</a>.  <a href="#name-pcb-extensions" class="internal xref">PCB Extensions</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="auto internal xref">2.2.3</a>.  <a href="#name-pcb-validity" class="internal xref">PCB Validity</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a href="#section-2.2.4" class="auto internal xref">2.2.4</a>.  <a href="#name-configuration" class="internal xref">Configuration</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-propagation-of-pcbs" class="internal xref">Propagation of PCBs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.1">
                    <p id="section-toc.1-1.2.2.3.2.1.1"><a href="#section-2.3.1" class="auto internal xref">2.3.1</a>.  <a href="#name-selection-of-pcbs-to-propag" class="internal xref">Selection of PCBs to Propagate</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.2">
                    <p id="section-toc.1-1.2.2.3.2.2.1"><a href="#section-2.3.2" class="auto internal xref">2.3.2</a>.  <a href="#name-propagation-of-selected-pcb" class="internal xref">Propagation of Selected PCBs</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.3">
                    <p id="section-toc.1-1.2.2.3.2.3.1"><a href="#section-2.3.3" class="auto internal xref">2.3.3</a>.  <a href="#name-effects-of-clock-inaccuracy" class="internal xref">Effects of Clock Inaccuracy</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-path-discovery-time-and-sca" class="internal xref">Path Discovery Time and Scalability</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4.2.1">
                    <p id="section-toc.1-1.2.2.4.2.1.1"><a href="#section-2.4.1" class="auto internal xref">2.4.1</a>.  <a href="#name-intra-isd-beaconing" class="internal xref">Intra-ISD Beaconing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4.2.2">
                    <p id="section-toc.1-1.2.2.4.2.2.1"><a href="#section-2.4.2" class="auto internal xref">2.4.2</a>.  <a href="#name-inter-isd-beaconing" class="internal xref">Inter-ISD Beaconing</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-registration-of-path-segmen" class="internal xref">Registration of Path Segments</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-intra-isd-path-segment-regi" class="internal xref">Intra-ISD Path-Segment Registration</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="auto internal xref">3.1.1</a>.  <a href="#name-terminating-a-pcb" class="internal xref">Terminating a PCB</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="auto internal xref">3.1.2</a>.  <a href="#name-transforming-a-pcb-into-an-" class="internal xref">Transforming a PCB into an Up-Segment</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.3">
                    <p id="section-toc.1-1.3.2.1.2.3.1"><a href="#section-3.1.3" class="auto internal xref">3.1.3</a>.  <a href="#name-transforming-a-pcb-into-a-d" class="internal xref">Transforming a PCB into a Down-Segment</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-core-path-segment-registrat" class="internal xref">Core Path-Segment Registration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-path-segment-registration-o" class="internal xref">Path-Segment Registration on Code-Level</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-path-lookup" class="internal xref">Path Lookup</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-lookup-process" class="internal xref">Lookup Process</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-sequence-of-lookup-requests" class="internal xref">Sequence of Lookup Requests</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-caching" class="internal xref">Caching</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-behavior-of-actors-in-the-l" class="internal xref">Behavior of Actors in the Lookup Process</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-use-of-wildcard-addresses-i" class="internal xref">Use of Wildcard Addresses in the Lookup Process</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-segment-request-handler-of-" class="internal xref">Segment-Request Handler of a Non-Core Source AS</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.3">
                    <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="auto internal xref">4.2.3</a>.  <a href="#name-segment-request-handler-of-a" class="internal xref">Segment-Request Handler of a Core AS</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-manipulation-of-the-beaconi" class="internal xref">Manipulation of the Beaconing Process by a Core Adversary</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-manipulation-of-the-beaconin" class="internal xref">Manipulation of the Beaconing Process by a Non-Core Adversary</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-path-hijacking-through-inte" class="internal xref">Path Hijacking through Interposition</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-creation-of-spurious-ases-a" class="internal xref">Creation of Spurious ASes and ISDs</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a href="#section-5.2.3" class="auto internal xref">5.2.3</a>.  <a href="#name-peering-link-misuse" class="internal xref">Peering Link Misuse</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.4">
                    <p id="section-toc.1-1.5.2.2.2.4.1"><a href="#section-5.2.4" class="auto internal xref">5.2.4</a>.  <a href="#name-manipulation-of-the-path-se" class="internal xref">Manipulation of the Path-Selection Process</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-denial-of-service-attacks" class="internal xref">Denial of Service Attacks</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-control-service-grpc-api" class="internal xref">Control Service gRPC API</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-scion-data-plane-use-by-the" class="internal xref">SCION data plane use by the SCION control plane</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-path-lookup-examples" class="internal xref">Path-Lookup Examples</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">SCION is a path-aware internetworking routing architecture as described in <span>[<a href="#RFC9217" class="cite xref">RFC9217</a>]</span>. It allows endpoints and applications to select paths across the network to use for traffic, based on trustworthy path properties. SCION is an inter-domain network architecture and is therefore not concerned with intra-domain forwarding.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">SCION has been developed with the following goals:<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3"><em>Availability</em> - to provide highly available communication that can send traffic over paths with optimal or required characteristics, quickly handle inter-domain link or router failures (both on the last hop or anywhere along the path) and provide continuity in the presence of adversaries.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4"><em>Security</em> - to provide higher levels of trust in routing information in order to prevent IP prefix hijacking/leaks, denial-of-service and other attacks. Endpoints can decide the trust roots they wish to rely on, routing information can be unambiguously attributed to an AS, and packets are only forwarded along authorized path segments. A particular use case is to enable geofencing.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5"><em>Scalability</em> - to improve the scalability of the inter-domain control plane and data plane, avoiding existing limitations related to convergence and forwarding table size. The advertising of path segments is separated into a beaconing process within each Isolation Domain (ISD) and between ISDs which incurs minimal overhead and resource requirements on routers.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">SCION relies on three main components:<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7"><em>PKI</em> - To achieve scalability and trust, SCION organizes existing ASes into logical groups of independent routing planes called <em>Isolation Domains (ISDs)</em>. All ASes in an ISD agree on a set of trust roots called the <em>Trust Root Configuration (TRC)</em> which is a collection of signed root certificates in X.509 v3 format <span>[<a href="#RFC5280" class="cite xref">RFC5280</a>]</span>. The ISD is governed by a set of <em>core ASes</em> which typically manage the trust roots and provide connectivity to other ISDs. This is the basis of the public key infrastructure which the SCION control plane relies upon for the authentication of messages that is used for the SCION control plane. See <span>[<a href="#I-D.scion-cppki" class="cite xref">I-D.scion-cppki</a>]</span><a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8"><em>Control Plane</em> - performs inter-domain routing by discovering and securely disseminating path information between ASes. The core ASes use Path-segment Construction Beacons (PCBs) to explore intra-ISD paths, or to explore paths across different ISDs.<a href="#section-1-8" class="pilcrow">¶</a></p>
<p id="section-1-9"><em>Data Plane</em> - carries out secure packet forwarding between SCION-enabled ASes over paths selected by endpoints. A SCION border router reuses existing intra-domain infrastructure to communicate to other SCION routers or SCION endpoints within its AS. See <span>[<a href="#I-D.scion-dp" class="cite xref">I-D.scion-dp</a>]</span><a href="#section-1-9" class="pilcrow">¶</a></p>
<p id="section-1-10">This document describes the SCION Control Plane component.<a href="#section-1-10" class="pilcrow">¶</a></p>
<div id="terms">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1"><strong>Autonomous System (AS)</strong>: An autonomous system is a network under a common administrative control. For example, the network of an Internet service provider, company, or university can constitute an AS.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2"><strong>Beaconing</strong>: The control-plane process where an AS discovers paths to other ASes.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3"><strong>Control Plane</strong>: The SCION control plane is responsible for the propagation and discovery of network paths, i.e., for the exchange of routing information between network nodes. The control plane thus determines where traffic can be sent and deals with questions such as how paths are discovered, which paths exist, what quality individual links offer, etc. Within a SCION AS, such functionalities are carried out by the control service. Packet forwarding is instead a task pertaining to the data plane.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4"><strong>Control Service</strong>: The control service is the main control-plane infrastructure component within a SCION AS. It is responsible for the path exploration and registration processes that take place within the control plane.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5"><strong>Core AS</strong>: Each isolation domain (ISD) is administered by a set of distinguished autonomous systems (ASes) called core ASes, which are responsible for initiating the path-discovery and -construction process (in SCION called "beaconing").<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<p id="section-1.1-6"><strong>Endpoint</strong>: An endpoint is the start- or the endpoint of a SCION path. For example, an endpoint can be a host as defined in <span>[<a href="#RFC1122" class="cite xref">RFC1122</a>]</span>, or a gateway bridging a SCION and an IP domain. This definition is based on the definition in <span>[<a href="#RFC9473" class="cite xref">RFC9473</a>]</span>.<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<p id="section-1.1-7"><strong>Forwarding Path</strong>: A forwarding path is a complete end-to-end path between two SCION hosts, which is used to transmit packets in the data plane and can be created with a combination of up to three path segments (an up-segment, a core-segment, and a down-segment).<a href="#section-1.1-7" class="pilcrow">¶</a></p>
<p id="section-1.1-8"><strong>Hop Field (HF)</strong>: As they traverse the network, path-segment construction beacons (PCBs) accumulate cryptographically protected AS-level path information in the form of hop fields. In the data plane, hop fields are used for packet forwarding: they contain the incoming and outgoing interface IDs of the ASes on the forwarding path.<a href="#section-1.1-8" class="pilcrow">¶</a></p>
<p id="section-1.1-9"><strong>Info Field (INF)</strong>: Each path-segment construction beacon (PCB) contains a single info field, which provides basic information about the PCB. Together with hop fields (HFs), info fields are used to create forwarding paths.<a href="#section-1.1-9" class="pilcrow">¶</a></p>
<p id="section-1.1-10"><strong>Isolation Domain (ISD)</strong>: In SCION, Autonomous Systems (ASes) are organized into logical groups called isolation domains or ISDs. Each ISD consists of ASes that span an area with a uniform trust environment (i.e., a common jurisdiction). A possible model is for ISDs to be formed along national boundaries or federations of nations.<a href="#section-1.1-10" class="pilcrow">¶</a></p>
<p id="section-1.1-11"><strong>Leaf AS</strong>: An AS at the "edge" of an ISD, with no other downstream ASes.<a href="#section-1.1-11" class="pilcrow">¶</a></p>
<p id="section-1.1-12"><strong>MAC</strong>: Message Authentication Code. In the rest of this document, "MAC" always refers to "Message Authentication Code" and never to "Medium Access Control". When "Medium Access Control address" is implied, the phrase "Link Layer Address" is used.<a href="#section-1.1-12" class="pilcrow">¶</a></p>
<p id="section-1.1-13"><strong>Packet-Carried Forwarding State (PCFS)</strong>: Rather than relying on costly inter-domain forwarding tables, SCION data packets contain all the necessary path information. We refer to this property as packet-carried forwarding state or PCFS.<a href="#section-1.1-13" class="pilcrow">¶</a></p>
<p id="section-1.1-14"><strong>Path Segment</strong>: Path segments are derived from path-segment construction beacons (PCBs) and registered at control services. A path segment can be (1) an up-segment (i.e., a path between a non-core AS and a core AS in the same ISD), (2) a down-segment (i.e., the same as an up-segment, but in the opposite direction), or (3) a core-segment (i.e., a path between core ASes). Up to three path segments can be used to create a forwarding path.<a href="#section-1.1-14" class="pilcrow">¶</a></p>
<p id="section-1.1-15"><strong>Path-Segment Construction Beacon (PCB)</strong>: Core ASes generate PCBs to explore paths within their isolation domain (ISD) and among different ISDs. ASes further propagate selected PCBs to their neighboring ASes. As a PCB traverses the network, it carries path segments, which can subsequently be used for traffic forwarding.<a href="#section-1.1-15" class="pilcrow">¶</a></p>
<p id="section-1.1-16"><strong>Trust Root Configuration (TRC)</strong>: A trust root configuration or TRC is a signed collection of certificates pertaining to an isolation domain (ISD). TRCs also contain ISD-specific policies.<a href="#section-1.1-16" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-1.2">
        <h3 id="name-conventions-and-definitions">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
        </h3>
<p id="section-1.2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="paths-links">
<section id="section-1.3">
        <h3 id="name-paths-and-links">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-paths-and-links" class="section-name selfRef">Paths and Links</a>
        </h3>
<p id="section-1.3-1">SCION routers and endpoints connect to each other via links. A SCION path between two endpoints essentially traverses one or more links.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<p id="section-1.3-2">In SCION, autonomous systems (ASes) are organized into logical groups called isolation domains or ISDs. Each ISD consists of ASes that span an area with a uniform trust environment (i.e., a common jurisdiction). An ISD is administered by a set of distinguished ASes called core ASes.<a href="#section-1.3-2" class="pilcrow">¶</a></p>
<p id="section-1.3-3">SCION distinguishes three types of links between ASes: (1) core links, (2) parent-child links, and (3) peering links.<a href="#section-1.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-4.1">
            <p id="section-1.3-4.1.1"><em>Core</em> links connect two core ASes, which are either within the same or in different ISDs. Core links can exist for various underlying business relationships, including provider-customer (where the customer pays the provider for traffic) and peering relationships.<a href="#section-1.3-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.3-4.2">
            <p id="section-1.3-4.2.1"><em>Parent-child</em> links create a hierarchy between the parent and the child AS within the same ISD. ASes with a parent-child link typically have a provider-customer relationship.<a href="#section-1.3-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.3-4.3">
            <p id="section-1.3-4.3.1"><em>Peering</em> links exist between ASes with a (settlement-free or paid) peering relationship. They can be established between any two ASes (core or non-core). Peering links can cross ISD boundaries.<a href="#section-1.3-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.3-5">These link types form the basis for the notion of "valley free" paths. Valley freeness means that a child AS does not carry transit traffic from a parent AS.
The SCION paths are always valley free, and consist of (at most) three segments; first an up-segment, traversing links from child to parent, then a core-segment consisting of core-links and then a down-segment traversing links from parent to child.
Peering link can be used as "shortcuts" in such an up-core-down path. A path can contain at most one peering link shortcut. Implicitly, peering links can thus only be used in paths between ASes in the "customer-cone" of the ASes connected by the peering link.<a href="#section-1.3-5" class="pilcrow">¶</a></p>
<p id="section-1.3-6">The following figure shows the three types of links for one small ISD with the two core ASes A and C, and the four non-core ASes D,E,F, and G.<a href="#section-1.3-6" class="pilcrow">¶</a></p>
<span id="name-the-three-types-of-scion-li"></span><div id="_figure-1">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.3-7.1">
<pre>
+-------------------------+
|                         |       #
|        ISD Core         |       |      parent-child
|  .---.           .---.  |       |      link
| (  A  )*-------*(  C  ) |       |
|  `-#-'           `-#-'  |       0
|    |               |    |
+----|---------------|----+   *-------*  core link
     |               |
     |               |        &lt; - - - &gt;  peering link
   .-0-.           .-0-.
  (  D  )&lt; - - - &gt;(  E  )
   `-#-'           `-#-'
     |               |
     |               |
     |               |
   .-0-.           .-0-.
  (  G  )         (  F  )
   `---'           `---'
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-the-three-types-of-scion-li" class="selfRef">The three types of SCION links in one ISD</a>
          </figcaption></figure>
</div>
<p id="section-1.3-8">Each link connecting SCION routers is bidirectional and identified by its corresponding egress and ingress interface IDs. An interface ID consists of a 16-bit identifier that <span class="bcp14">MUST</span> be unique within each AS, with the exception of value 0 (see <span>[<a href="#I-D.scion-dp" class="cite xref">I-D.scion-dp</a>]</span>). Therefore, they can be chosen and encoded by each AS independently and without any need for coordination between ASes.<a href="#section-1.3-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="routing">
<section id="section-1.4">
        <h3 id="name-routing">
<a href="#section-1.4" class="section-number selfRef">1.4. </a><a href="#name-routing" class="section-name selfRef">Routing</a>
        </h3>
<p id="section-1.4-1">SCION provides path-aware inter-domain routing between ASes across the Internet. The SCION control plane is responsible for discovering these inter-domain paths and making them available to the endpoints within the ASes. SCION inter-domain routing operates on two levels: Within a SCION isolation domain (ISD), which is called <em>intra</em>-ISD routing, and between ISDs, called <em>inter</em>-ISD routing. Both levels use the so-called <em>path-segment construction beacons (PCBs)</em> to explore network paths. A PCB is initiated by a core AS and then disseminated either within an ISD to explore intra-ISD paths, or among core ASes, to explore core paths across different ISDs.<a href="#section-1.4-1" class="pilcrow">¶</a></p>
<p id="section-1.4-2">The PCBs accumulate cryptographically protected path and forwarding information on AS-level, and store this information in the form of <em>hop fields</em>. Endpoints use information from these hop fields to create end-to-end forwarding paths for data packets, who carry this information in their packet headers. This concept is called <em>packet-carried forwarding state</em>. The concept also supports multi-path communication among endpoints.<a href="#section-1.4-2" class="pilcrow">¶</a></p>
<p id="section-1.4-3">The creation of an end-to-end forwarding path consists of the following processes:<a href="#section-1.4-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1.4-4">
<li id="section-1.4-4.1">
            <p id="section-1.4-4.1.1"><em>Path exploration (or beaconing)</em>: This is the process where an AS discovers paths to other ASes. See also <a href="#beaconing" class="auto internal xref">Section 2</a>.<a href="#section-1.4-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-1.4-4.2">
            <p id="section-1.4-4.2.1"><em>Path registration</em>: This is the process where an AS selects a few PCBs, according to defined policies, turns the selected PCBs into path segments, and adds these path segments to the relevant path infrastructure, thus making them available to other ASes. See also <a href="#path-segment-reg" class="auto internal xref">Section 3</a>.<a href="#section-1.4-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-1.4-4.3">
            <p id="section-1.4-4.3.1"><em>Path resolution</em>: This is the process of actually creating an end-to-end forwarding path from the source endpoint to the destination. For this, an endpoint performs (a) a path lookup step, to obtain path segments, and (b) a path combination step, to combine the forwarding path from the segments. This last step takes place in the data plane. See also <a href="#lookup" class="auto internal xref">Section 4</a>.<a href="#section-1.4-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-1.4-5">All processes operate concurrently.<a href="#section-1.4-5" class="pilcrow">¶</a></p>
<p id="section-1.4-6"><a href="#_figure-2" class="auto internal xref">Figure 2</a> below shows the SCION routing processes and their relation to each other.<a href="#section-1.4-6" class="pilcrow">¶</a></p>
<span id="name-scion-routing-processes-and"></span><div id="_figure-2">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-1.4-7.1">
<pre>
+-------------------------+       +-------------------------+
| Exploration (Beaconing) |------&gt;|      Registration       |
+-------------------------+       +-----------+-------------+
                                              |
                              +---------------+
                              |
     +------------------------v------------------------+
     |                 Path Resolution                 |
     |                                                 |
     |   +----------------+       +----------------+   |
     |   |     Lookup     +------&gt;|  Combination   |   |
     |   |                |       |    (Data Plane)|   |
     |   +----------------+       +----------------+   |
     +-------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-scion-routing-processes-and" class="selfRef">SCION routing processes and their relation to each other. All processes operate concurrently</a>
          </figcaption></figure>
</div>
<p id="section-1.4-8">The <strong>control service</strong> is responsible for the path exploration and registration processes in the control plane. It is the main control-plane infrastructure component within each SCION AS. The control service of an AS has the following tasks:<a href="#section-1.4-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-9.1">
            <p id="section-1.4-9.1.1">Generating, receiving, and propagating PCBs. Periodically, the control service of a core AS generates a set of PCBs, which are forwarded to the child ASes or neighboring core ASes. In the latter case, the PCBs are sent over policy-compliant paths to discover multiple paths between any pair of core ASes.<a href="#section-1.4-9.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.4-9.2">
            <p id="section-1.4-9.2.1">Selecting and registering the set of path segments via which the AS wants to be reached.<a href="#section-1.4-9.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.4-9.3">
            <p id="section-1.4-9.3.1">Managing certificates and keys to secure inter-AS communication. Each PCB contains signatures of all on-path ASes. Every time the control service of an AS receives a PCB, it validates the PCB's authenticity. When the control service lacks an intermediate certificate, it can query the control service of the neighboring AS that sent the PCB.<a href="#section-1.4-9.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.4-10"><strong>Note:</strong> The control service of an AS must not be confused with a border router. The control service of a specific AS is part of the control plane and responsible for <em>finding and registering suitable paths</em>. It can be deployed anywhere inside the AS. A border router belongs to the data plane; its main task is to <em>forward data packets</em>. Border routers are deployed at the edge of an AS.<a href="#section-1.4-10" class="pilcrow">¶</a></p>
<div id="path-segments">
<section id="section-1.4.1">
          <h4 id="name-path-segments">
<a href="#section-1.4.1" class="section-number selfRef">1.4.1. </a><a href="#name-path-segments" class="section-name selfRef">Path Segments</a>
          </h4>
<p id="section-1.4.1-1">As described previously, the main goal of SCION's control plane is to create and manage path segments, which can then be combined into forwarding paths to transmit packets in the data plane. SCION distinguishes the following types of path segments:<a href="#section-1.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4.1-2.1">
              <p id="section-1.4.1-2.1.1">A path segment from a non-core AS to a core AS is an <em>up-segment</em>.<a href="#section-1.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-1.4.1-2.2">
              <p id="section-1.4.1-2.2.1">A path segment from a core AS to a non-core AS is a <em>down-segment</em>.<a href="#section-1.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-1.4.1-2.3">
              <p id="section-1.4.1-2.3.1">A path segment between core ASes is a <em>core-segment</em>.<a href="#section-1.4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-1.4.1-3">So each path segment either ends at a core AS, or starts at a core AS, or both.<a href="#section-1.4.1-3" class="pilcrow">¶</a></p>
<p id="section-1.4.1-4">All path segments are invertible: A core-segment can be used bidirectionally, and an up-segment can be converted into a down-segment, or vice versa, depending on the direction of the end-to-end path. This means that all path segments can be used to send data traffic in both directions.<a href="#section-1.4.1-4" class="pilcrow">¶</a></p>
<p id="section-1.4.1-5">The cryptographic protection of PCBs / path segments is based on the Control-Plane PKI. The signatures are structured such that the entire message sequence constituting the path segment can be authenticated. The authenticity can be verified by anyone with access to this PKI.
For fast validation of the path information carried in individual packets during packet forwarding, symmetric key cryptography is used instead. For this purpose, the hop fields contain a MAC. These MACs are structured to allow verifying the sequence of hops, reflecting the structure of the PCBs, but, in contrast to the PCBs, this can only be validated by the border routers of the respective AS.<a href="#section-1.4.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="numbering">
<section id="section-1.5">
        <h3 id="name-addressing">
<a href="#section-1.5" class="section-number selfRef">1.5. </a><a href="#name-addressing" class="section-name selfRef">Addressing</a>
        </h3>
<p id="section-1.5-1">The inter-domain SCION routing is based on the &lt;ISD, AS&gt; tuple. Although a complete SCION address is composed of the &lt;ISD, AS, endpoint address&gt; 3-tuple, the endpoint address is not used for inter-domain routing or forwarding. The endpoint address can be of variable length, does not need to be globally unique, and can thus be an IPv4, IPv6, or link layer address, for example - in fact, the endpoint address is the "normal", currently used, non-SCION-specific endpoint address.<a href="#section-1.5-1" class="pilcrow">¶</a></p>
<p id="section-1.5-2">However, the ISD-AS number is a SCION-specific number. It consists of 64-bits, with the top 16 bits indicating the ISD, and the bottom 48 bits indicating the AS. The text representation uses a dash-separator between the ISD and AS numbers, for example: <code>4-ff00:1:f</code>. This section provides more details about the numbering scheme for SCION ISD and AS numbers.<a href="#section-1.5-2" class="pilcrow">¶</a></p>
<p id="section-1.5-3"><strong>Note:</strong> As a consequence of the fact that SCION relies on existing routing protocols (e.g., IS-IS, OSPF, SR) and communication fabric (e.g., IP, MPLS) for intra-domain forwarding, existing internal routers do not need to be changed to support SCION.<a href="#section-1.5-3" class="pilcrow">¶</a></p>
<div id="isd-numbers">
<section id="section-1.5.1">
          <h4 id="name-isd-numbers">
<a href="#section-1.5.1" class="section-number selfRef">1.5.1. </a><a href="#name-isd-numbers" class="section-name selfRef">ISD Numbers</a>
          </h4>
<p id="section-1.5.1-1">An ISD number is the 16-bit global identifier for an ISD. It <span class="bcp14">MUST</span> be globally unique. The following table gives an overview of the ISD number allocation.<a href="#section-1.5.1-1" class="pilcrow">¶</a></p>
<span id="name-isd-number-allocations"></span><div id="_table-1">
<table class="center" id="table-1">
            <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-isd-number-allocations" class="selfRef">ISD number allocations</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">ISD</th>
                <th class="text-left" rowspan="1" colspan="1">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">The wildcard ISD.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1 - 15</td>
                <td class="text-left" rowspan="1" colspan="1">Reserved for documentation and sample code (analogous to <span>[<a href="#RFC5398" class="cite xref">RFC5398</a>]</span>).</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">16 - 63</td>
                <td class="text-left" rowspan="1" colspan="1">Private use (analogous to <span>[<a href="#RFC6996" class="cite xref">RFC6996</a>]</span>). Can be used for testing and private deployments</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">64 - 4094</td>
                <td class="text-left" rowspan="1" colspan="1">Public ISDs. Should be allocated in ascending order, without gaps and "vanity" numbers.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">4095 - 65535</td>
                <td class="text-left" rowspan="1" colspan="1">Reserved for future use.</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-1.5.1-3">Currently, ISD numbers are allocated by Anapaya, the Swiss-based provider of SCION-based networking software and solutions (see <a href="https://docs.anapaya.net/en/latest/resources/isd-as-assignments/">Anapaya ISD AS assignments</a>).<a href="#section-1.5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scion-as-numbers">
<section id="section-1.5.2">
          <h4 id="name-scion-as-numbers">
<a href="#section-1.5.2" class="section-number selfRef">1.5.2. </a><a href="#name-scion-as-numbers" class="section-name selfRef">SCION AS Numbers</a>
          </h4>
<p id="section-1.5.2-1">A SCION AS number is the 48-bit identifier for an AS. Although they play a similar role, there is no relationship between SCION AS numbers and BGP ASNs as defined by RFC4893. For historical reasons some SCION autonomous systems use a SCION AS number where the first 16 bits are 0, and the remaining 32 bits are identical to their BGP ASN. There is no technical requirement for such an equality.<a href="#section-1.5.2-1" class="pilcrow">¶</a></p>
<div id="text-representation">
<section id="section-1.5.2.1">
            <h5 id="name-text-representation">
<a href="#section-1.5.2.1" class="section-number selfRef">1.5.2.1. </a><a href="#name-text-representation" class="section-name selfRef">Text Representation</a>
            </h5>
<p id="section-1.5.2.1-1">The default text representation for SCION AS numbers is very similar to IPv6 (see <span>[<a href="#RFC5952" class="cite xref">RFC5952</a>]</span>). It uses a 16-bit colon-separated lower-case hex encoding with leading 0's omitted: <code>0:0:0</code> to <code>ffff:ffff:ffff</code>.<a href="#section-1.5.2.1-1" class="pilcrow">¶</a></p>
<p id="section-1.5.2.1-2">In SCION, the following rules apply:<a href="#section-1.5.2.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.5.2.1-3.1">
                <p id="section-1.5.2.1-3.1.1">The <code>::</code> zero-compression feature of IPv6 <span class="bcp14">MUST NOT</span> be used. The feature has very limited use in a 48-bit address space and would only add more complexity.<a href="#section-1.5.2.1-3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-1.5.2.1-3.2">
                <p id="section-1.5.2.1-3.2.1">A range of AS numbers can be shortened with a notation similar to the one used for CIDR IP ranges (<span>[<a href="#RFC4632" class="cite xref">RFC4632</a>]</span>). For example, the range of the lowest 32-bit AS numbers (0-4294967295) can be represented as <code>0:0:0/16</code>.<a href="#section-1.5.2.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-1.5.2.1-4">For historical reasons, SCION AS numbers in the lower 32 bit range <span class="bcp14">MAY</span> also be represented as decimal for human readability. For example, if a program receives the AS number <code>0:1:f</code>, it <span class="bcp14">MAY</span> display the number as "65551".<a href="#section-1.5.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="special-purpose-scion-as-numbers">
<section id="section-1.5.2.2">
            <h5 id="name-special-purpose-scion-as-nu">
<a href="#section-1.5.2.2" class="section-number selfRef">1.5.2.2. </a><a href="#name-special-purpose-scion-as-nu" class="section-name selfRef">Special-Purpose SCION AS Numbers</a>
            </h5>
<span id="name-as-number-allocations"></span><div id="_table-2">
<table class="center" id="table-2">
              <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-as-number-allocations" class="selfRef">AS number allocations</a>
              </caption>
<thead>
                <tr>
                  <th class="text-left" rowspan="1" colspan="1">AS</th>
                  <th class="text-left" rowspan="1" colspan="1">Size</th>
                  <th class="text-left" rowspan="1" colspan="1">Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">
                    <code>0:0:0</code>
</td>
                  <td class="text-left" rowspan="1" colspan="1">1</td>
                  <td class="text-left" rowspan="1" colspan="1">The wildcard AS</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">
                    <code>0:0:1-0:ffff:ffff</code>
</td>
                  <td class="text-left" rowspan="1" colspan="1">~4.3 bill.</td>
                  <td class="text-left" rowspan="1" colspan="1">Public SCION AS numbers</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">
                    <code>1:0:0</code>
</td>
                  <td class="text-left" rowspan="1" colspan="1">1</td>
                  <td class="text-left" rowspan="1" colspan="1">Reserved</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">
                    <code>2:0:0/16</code>
</td>
                  <td class="text-left" rowspan="1" colspan="1">~4.3 bill.</td>
                  <td class="text-left" rowspan="1" colspan="1">Additional public SCION AS numbers</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">
                    <code>ff00:0:0/32</code>
</td>
                  <td class="text-left" rowspan="1" colspan="1">65535</td>
                  <td class="text-left" rowspan="1" colspan="1">Reserved for documentation and test/sample code (analogous to <span>[<a href="#RFC5398" class="cite xref">RFC5398</a>]</span>).</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">
                    <code>ffaa:0:0/24</code>
</td>
                  <td class="text-left" rowspan="1" colspan="1">~16.8 mill.</td>
                  <td class="text-left" rowspan="1" colspan="1">Reserved for private use (analogous to <span>[<a href="#RFC6996" class="cite xref">RFC6996</a>]</span>). These numbers can be used for testing/private deployments.</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">
                    <code>ffff:ffff:ffff</code>
</td>
                  <td class="text-left" rowspan="1" colspan="1">1</td>
                  <td class="text-left" rowspan="1" colspan="1">Reserved</td>
                </tr>
              </tbody>
            </table>
</div>
<p id="section-1.5.2.2-2">The rest of the space is currently unallocated.<a href="#section-1.5.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="serv-disc">
<section id="section-1.5.3">
          <h4 id="name-wildcard-addressing">
<a href="#section-1.5.3" class="section-number selfRef">1.5.3. </a><a href="#name-wildcard-addressing" class="section-name selfRef">Wildcard Addressing</a>
          </h4>
<p id="section-1.5.3-1">SCION allows endpoints to use wildcard addresses in the control-plane routing, to designate any core AS, e.g., to place requests for core- or down-segments during path lookup. These wildcard addresses are of the form I-0, to designate any AS in ISD I. Here, "0" is the wildcard for the AS. For more information, see <a href="#wildcard" class="auto internal xref">Section 4.2.1</a>.<a href="#section-1.5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="avoiding-circular-dependencies-and-partitioning">
<section id="section-1.6">
        <h3 id="name-avoiding-circular-dependenc">
<a href="#section-1.6" class="section-number selfRef">1.6. </a><a href="#name-avoiding-circular-dependenc" class="section-name selfRef">Avoiding Circular Dependencies and Partitioning</a>
        </h3>
<p id="section-1.6-1">A secure and reliable routing architecture has to be designed specifically to avoid circular dependencies during network initialization. One goal of SCION is that the Internet can start up even after large outages or attacks, in addition to avoiding cascades of outages caused by fragile interdependencies. This section lists the concepts SCION uses to prevent circular dependencies.<a href="#section-1.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.6-2.1">
            <p id="section-1.6-2.1.1">Neighbor-based path discovery: Path discovery in SCION is performed by the beaconing mechanism. In order to participate in this process, an AS only needs to be aware of its direct neighbors. As long as no path segments are available, communicating with the neighboring ASes is possible with the one-hop path type, which does not rely on any path information. SCION uses these <em>one-hop paths</em> to propagate PCBs to neighboring ASes to which no forwarding path is available yet. The One-Hop Path Type is described in more detail in <span>[<a href="#I-D.scion-dp" class="cite xref">I-D.scion-dp</a>]</span>.<a href="#section-1.6-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.6-2.2">
            <p id="section-1.6-2.2.1">Path segment types: SCION uses different types of path segments to compose end-to-end paths. Notably, a single path segment already enables intra-ISD communication. For example, a non-core AS can reach the core of the local ISD simply by using an up-segment fetched from the local path storage, which is populated during the beaconing process.<a href="#section-1.6-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.6-2.3">
            <p id="section-1.6-2.3.1">Path reversal: In SCION, every path is reversible. That is, the receiver of a packet can reverse the path in the packet header in order to produce a reply packet without having to perform a path lookup. Such a packet follows the original packet's path backwards.<a href="#section-1.6-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.6-2.4">
            <p id="section-1.6-2.4.1">Availability of certificates: In SCION, every entity is required to be in possession of all cryptographic material (including the ISD's Trust Root Configuration TRC and certificates) that is needed to verify any message it sends. This (together with the path reversal) means that the receiver of a message can always obtain all this necessary material by contacting the sender.<br>
              <strong>Note:</strong> For a detailed description of a TRC and more information on the availability of certificates and TRCs, see the SCION Control-Plane PKI Internet-Draft <span>[<a href="#I-D.scion-cppki" class="cite xref">I-D.scion-cppki</a>]</span>.<a href="#section-1.6-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div id="partition-and-healing">
<section id="section-1.6.1">
          <h4 id="name-partition-and-healing">
<a href="#section-1.6.1" class="section-number selfRef">1.6.1. </a><a href="#name-partition-and-healing" class="section-name selfRef">Partition and Healing</a>
          </h4>
<p id="section-1.6.1-1">Besides inter-dependencies, another threat to the Internet is network partition. Partition occurs when one network is split into two because of a link failure. However, partition of the global SCION inter-domain network is much less likely to happen: During normal operation, the full network fabric is available, offering multiple paths between all ASes. Even during failures there is no special failure mode required, as SCION-enabled ASes could always switch to otherwise unused links.<a href="#section-1.6.1-1" class="pilcrow">¶</a></p>
<p id="section-1.6.1-2">Recovering (also called healing) from a partitioned network is also seamless, as only coarse time synchronization between the partitions is required to resume normal operation and move forward with updates of the cryptographic material.<a href="#section-1.6.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="communication-protocol">
<section id="section-1.7">
        <h3 id="name-communication-protocol">
<a href="#section-1.7" class="section-number selfRef">1.7. </a><a href="#name-communication-protocol" class="section-name selfRef">Communication Protocol</a>
        </h3>
<p id="section-1.7-1">All communication between the control services in different ASes is expressed in terms of gRPC remote procedure calls (for details, see <span>[<a href="#gRPC" class="cite xref">gRPC</a>]</span>). Service interfaces and messages are defined in the Protocol Buffer "proto3" interface definition language (for details, see <span>[<a href="#proto3" class="cite xref">proto3</a>]</span>).<a href="#section-1.7-1" class="pilcrow">¶</a></p>
<p id="section-1.7-2">The RPC messages are transported via the <span>[<a href="#Connect" class="cite xref">Connect</a>]</span>'s rpc protocol; a gRPC-like protocol that carries messages over HTTP/3 (see <span>[<a href="#RFC9114" class="cite xref">RFC9114</a>]</span>)). HTTP3 traffic uses QUIC/UDP (<span>[<a href="#RFC9000" class="cite xref">RFC9000</a>]</span>) as a transport layer. In the case of SCION, UDP relies on the SCION data plane.<a href="#section-1.7-2" class="pilcrow">¶</a></p>
<p id="section-1.7-3"><a href="#app-a" class="auto internal xref">Appendix "Control Service gRPC API"</a> provides the entire control service API definition in protobuf format.<a href="#section-1.7-3" class="pilcrow">¶</a></p>
<p id="section-1.7-4"><a href="#app-b" class="auto internal xref">Appendix "SCION data plane use by the SCION control plane"</a> provides details about the establishment of the underlying QUIC connections through the SCION data plane.<a href="#section-1.7-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="beaconing">
<section id="section-2">
      <h2 id="name-path-exploration-or-beaconi">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-path-exploration-or-beaconi" class="section-name selfRef">Path Exploration or Beaconing</a>
      </h2>
<div id="introduction-and-overview">
<section id="section-2.1">
        <h3 id="name-introduction-and-overview">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-introduction-and-overview" class="section-name selfRef">Introduction and Overview</a>
        </h3>
<p id="section-2.1-1"><strong>Path exploration</strong> is the process where an AS discovers paths to other ASes. In SCION, this process is referred to as <em>beaconing</em>. This section gives a detailed explanation of the SCION beaconing process.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">In SCION, the <em>control service</em> of each AS is responsible for the beaconing process. The control service generates, receives, and propagates so-called <em>path-segment construction beacons (PCBs)</em> on a regular basis, to iteratively construct path segments. PCBs contain topology and authentication information, and can also include additional metadata that helps with path management and selection. The beaconing process itself is divided into routing processes on two levels, where <em>inter-ISD</em> or core beaconing is based on the (selective) sending of PCBs without a defined direction, and <em>intra-ISD</em> beaconing on top-to-bottom propagation.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-3.1">
            <p id="section-2.1-3.1.1"><em>Inter-ISD or core beaconing</em> is the process of constructing path segments between core ASes in the same or in different ISDs. During core beaconing, the control service of a core AS either initiates PCBs or propagates PCBs received from neighboring core ASes to other neighboring core ASes. Core beaconing is periodic; PCBs are sent over policy-compliant paths to discover multiple paths between any pair of core ASes.<a href="#section-2.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-3.2">
            <p id="section-2.1-3.2.1"><em>Intra-ISD beaconing</em> creates path segments from core ASes to non-core ASes. For this, the control service of a core AS creates PCBs and sends them to the non-core child ASes (typically customer ASes). The control service of a non-core child AS receives these PCBs and forwards them to its child ASes, and so on. This procedure continues until the PCB reaches an AS without any customer (leaf AS). As a result, all ASes within an ISD receive path segments to reach the core ASes of their ISD.<a href="#section-2.1-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.1-4">On its way, a PCB accumulates cryptographically protected path- and forwarding information per traversed AS. At every AS, metadata as well as information about the AS's ingress and egress interfaces are added to the PCB.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<div id="peering-links">
<section id="section-2.1.1">
          <h4 id="name-peering-links">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-peering-links" class="section-name selfRef">Peering Links</a>
          </h4>
<p id="section-2.1.1-1">PCBs do not traverse peering links. Instead, peering links are announced along with a regular path in a PCB. If both ASes at either end of a peering link have registered path segments that include this specific peering link, then it is possible to use this peering link during segment combination to create the end-to-end path.<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="extending-a-pcb">
<section id="section-2.1.2">
          <h4 id="name-extending-a-pcb">
<a href="#section-2.1.2" class="section-number selfRef">2.1.2. </a><a href="#name-extending-a-pcb" class="section-name selfRef">Extending a PCB</a>
          </h4>
<p id="section-2.1.2-1">Every propagation period (as configured by the AS), the control service:<a href="#section-2.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1.2-2.1">
              <p id="section-2.1.2-2.1.1">selects the best combinations of PCBs and interfaces connecting to a neighboring AS (i.e., a child AS or a core AS), and<a href="#section-2.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.2-2.2">
              <p id="section-2.1.2-2.2.1">sends each selected PCB to the selected egress interface(s) associated with it.<a href="#section-2.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.1.2-3">For every selected PCB and egress interface combination, the AS extends the PCB by adding a so-called <em>AS entry</em> to the selected PCB. Such an AS entry includes a hop field that specifies the incoming (ingress) and outgoing (egress) interface for the packet forwarding through this AS, in the beaconing direction. The AS entry can also contain peer entries.<a href="#section-2.1.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1.2-4.1">
              <p id="section-2.1.2-4.1.1">For the specification of one PCB, see <a href="#pcbs" class="auto internal xref">Section 2.2</a><a href="#section-2.1.2-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.2-4.2">
              <p id="section-2.1.2-4.2.1">For more details on selecting PCBs, see <a href="#selection" class="auto internal xref">Section 2.3.1</a><a href="#section-2.1.2-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.2-4.3">
              <p id="section-2.1.2-4.3.1">For more details on propagating PCBs, see <a href="#path-segment-prop" class="auto internal xref">Section 2.3.2</a><a href="#section-2.1.2-4.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="pcb-propagation-illustrated-examples">
<section id="section-2.1.3">
          <h4 id="name-pcb-propagation-illustrated">
<a href="#section-2.1.3" class="section-number selfRef">2.1.3. </a><a href="#name-pcb-propagation-illustrated" class="section-name selfRef">PCB Propagation - Illustrated Examples</a>
          </h4>
<p id="section-2.1.3-1">The following three figures show how intra-ISD PCB propagation works, from the ISD's core AS down to child ASes. For the sake of illustration, the interfaces of each AS are numbered with integer values.<a href="#section-2.1.3-1" class="pilcrow">¶</a></p>
<p id="section-2.1.3-2">In <a href="#_figure-3a" class="auto internal xref">Figure 3</a> below, core AS X sends the two different PCBs "a" and "b" via two different links to child AS Y: PCB "a" leaves core AS X via egress interface "2", whereas PCB "b" is sent over egress interface "1". Core AS X adds the respective egress information to the PCBs when sending them off, as can be seen in the figure (the entries "<em>Core - Out:2</em>" and "<em>Core - Out:1</em>", respectively).<a href="#section-2.1.3-2" class="pilcrow">¶</a></p>
<span id="name-intra-isd-pcb-propagation-f"></span><div id="_figure-3a">
<figure id="figure-3">
            <div class="alignLeft art-text artwork" id="section-2.1.3-3.1">
<pre>
                            +-------------+
                            | Core AS X   |
                            |             |
                            |    2   1    |
                            +----#---#----+
          +--------+             |   |             +--------+
          |PCB     |     +-----+ |   | +-----+     |PCB     |
          |========|-----|PCB a| |   | |PCB b|=====|++++++++|
          |Core    |     +-----+ |   | +-----+     |Core    |
          |- Out:2 |        |    |   |    |        |- Out:1 |
          +--------+        v    |   |    v        +--------+
                                 v   v
                            +----#---#----+
                            |     AS Y    |
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-intra-isd-pcb-propagation-f" class="selfRef">Intra-ISD PCB propagation from the ISD core to child ASes - Part 1</a>
            </figcaption></figure>
</div>
<p id="section-2.1.3-4">AS Y receives the two PCBs "a" and "b" through two different (ingress) interfaces, namely "2" and "3", respectively (see <a href="#_figure-3b" class="auto internal xref">Figure 4</a> below). Additionally, AS Y forwards to AS Z four PCBs that were previously sent by core AS X. For this, AS Y uses the two different (egress) links "5" and "6". AS Y extends the four PCBs with the corresponding ingress and egress interface information. As can be seen in the figure, AS Y also has two peering links to its neighboring peers V and W, through the interfaces "1" and "4", respectively - AS Y includes this information in the PCBs, as well. Thus, each forwarded PCB cumulates path information on its way "down" from core AS X.<a href="#section-2.1.3-4" class="pilcrow">¶</a></p>
<span id="name-intra-isd-pcb-propagation-fr"></span><div id="_figure-3b">
<figure id="figure-4">
            <div class="alignLeft art-text artwork" id="section-2.1.3-5.1">
<pre>
                        +-----+ |   | +-----+
                        |PCB a| |   | |PCB b|
                        +-----+ |   | +-----+
                           |    |   |    |
                           v    |   |    v
                                v   v
                           +----#---#----+
                 .---.     |    2   3    |
                (  V  )- --# 1           |
                 `---'     |     AS Y    |     .---.
                           |           4 #- --(  W  )
                           |             |     `---'
                           |    6   5    |
            +--------+     +----#---#----+     +--------+
            |PCB     |          |   |          |PCB     |
            |========|          |   |          |========|
            |Core X  |          |   |          |Core X  |
            |- Out:2 |          |   |          |- Out:2 |
+--------+  |--------|  +-----+ |   | +-----+  |--------|  +--------+
|PCB     |  |AS Y    |--|PCB c| |   | |PCB d|--|AS Y    |  |PCB     |
|++++++++|  |-In:2   |  +-----+ |   | +-----+  |-In:2   |  |++++++++|
|Core X  |  |-Out:6  |     |    |   |    |     |-Out:5  |  |Core X  |
|- Out:1 |  |-PeerV:1|     v    |   |    v     |-PeerV:1|  |- Out:1 |
|--------|  |-PeerW:4|          |   |          |-PeerW:4|  |--------|
|AS Y    |  +--------+          |   |          +--------+  |AS Y    |
|-In:3   |              +-----+ |   | +-----+              |-In:3   |
|-Out:6  |==============|PCB e| |   | |PCB f|==============|-Out:5  |
|-PeerV:1|              +-----+ |   | +-----+              |-PeerV:1|
|-PeerW:4|                 |    |   |    |                 |-PeerW:4|
+--------+                 v    |   |    v                 +--------+
                                v   v
                           +----#---#----+
                           |    AS Z     |

</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-intra-isd-pcb-propagation-fr" class="selfRef">Intra-ISD PCB propagation from the ISD core to child ASes - Part 2</a>
            </figcaption></figure>
</div>
<p id="section-2.1.3-6">The following figure shows how the four PCBs "c", "d", "e", and "f", coming from AS Y, are received by AS Z over two different links: PCBs "c" and "e" reach AS Z over ingress interface "5", whereas PCBs "d" and "f" enter AS Z via ingress interface "1". Additionally, AS Z propagates PCBs "g", "h", "i", and "j" further down, all over the same link (egress interface "3"). AS Z extends the PCBs with the relevant information, so that each of these PCBs now includes AS hop entries from core AS X, AS Y, and AS Z.<a href="#section-2.1.3-6" class="pilcrow">¶</a></p>
<span id="name-intra-isd-pcb-propagation-fro"></span><div id="_figure-3c">
<figure id="figure-5">
            <div class="alignLeft art-text artwork" id="section-2.1.3-7.1">
<pre>
                   +-----+      |   |      +-----+
                   |PCB c|      |   |      |PCB d|
                   +-----+      |   |      +-----+
                     |  +-----+ |   | +-----+  |
                     v  |PCB e| |   | |PCB f|  v
                        +-----+ |   | +-----+
                           |    |   |    |
                           v    |   |    v
                                v   v
                         +------#---#------+
                         |      5   1      |
                         |                 |
                         | AS Z            |
            +--------+   |        3        |   +--------+
            |PCB     |   +--------#--------+   |PCB     |
            |========|            |            |========|
            |Core X  |            |            |Core X  |
+--------+  |- Out:2 |            |            |- Out:2 |  +--------+
|PCB     |  |--------|            |            |--------|  |PCB     |
|++++++++|  |AS Y    |            |            |AS Y    |  |++++++++|
|Core X  |  |-In:2   |            |            |-In:2   |  |Core X  |
|- Out:1 |  |-Out:6  |   +-----+  |  +-----+   |-Out:5  |  |- Out:1 |
|--------|  |-PeerV:1|---|PCB g|  |  |PCB h|---|-PeerV:1|  |--------|
|AS Y    |  |-PeerW:4|   +-----+  |  +-----+   |-PeerW:4|  |AS Y    |
|-In:3   |  |--------|      |     |     |      |--------|  |-In:3   |
|-Out:6  |  |AS Z    |      v     |     v      |AS Z    |  |-Out:5  |
|-PeerV:1|  |-In:5   |            |            |-In:1   |  |-PeerV:1|
|-PeerW:4|  |-Out:3  |            |            |-Out:3  |  |-PeerW:4|
|--------|  +--------+            |            +--------+  |--------|
|AS Z    |               +-----+  |  +-----+               |AS Z    |
|-In:5   |===============|PCB i|  |  |PCB j|===============|-In:1   |
|-Out:3  |               +-----+  |  +-----+               |-Out:3  |
+--------+                  |     |     |                  +--------+
                            v     |     v
                                  v

</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-intra-isd-pcb-propagation-fro" class="selfRef">Intra-ISD PCB propagation from the ISD core to child ASes - Part 3</a>
            </figcaption></figure>
</div>
<p id="section-2.1.3-8">Based on the figures above, one could say that a PCB represents a single path segment. However, there is a difference between a PCB and a (registered) path segment. A PCB is a so-called "travelling path segment" that accumulates AS entries when traversing the Internet. A (registered) path segment, instead, is a "snapshot" of a travelling PCB at a given time T and from the vantage point of a particular AS A. This is illustrated by <a href="#_figure-4" class="auto internal xref">Figure 6</a>. This figure shows several possible path segments to reach AS Z, based on the PCBs "g", "h", "i", and "j" from <a href="#_figure-3c" class="auto internal xref">Figure 5</a> above. It is up to AS Z to use all of these path segments or just a selection of them.<a href="#section-2.1.3-8" class="pilcrow">¶</a></p>
<span id="name-possible-up-or-down-segment"></span><div id="_figure-4">
<figure id="figure-6">
            <div class="alignLeft art-text artwork" id="section-2.1.3-9.1">
<pre>
                AS Entry Core         AS Entry Y          AS Entry Z

               +-------------+     +-------------+     +-------------+
               |  Core AS X  |     |    AS Y     |     |     AS Z    |
path segment 1 |            1#     #3            5     #1            |
               |             |     |             |     |             |
               |            2#-----#2----------- 6-----#5            |
               |             |     |             |     |             |
               +-------------+     +-------------+     +-------------+
                 egress 2       ingress 2 - egress 6      ingress 5

----------------------------------------------------------------------

               +-------------+     +-------------+     +-------------+
               |  Core AS X  |     |    AS Y     |     |     AS Z    |
               |            1#     #3     +-----5#-----#1            |
path segment 2 |             |     |      |      |     |             |
               |            2#-----#2-----+     6#     #5            |
               |             |     |             |     |             |
               +-------------+     +-------------+     +-------------+
                 egress 2       ingress 2 - egress 5      ingress 1

------------------------------------------------------------------------

               +-------------+     +-------------+     +-------------+
               |  Core AS X  |     |    AS Y     |     |     AS Z    |
               |            1#-----#3-----+     5#     #1            |
path segment 3 |             |     |      |      |     |             |
               |            2#     #2     +-----6#-----#5            |
               |             |     |             |     |             |
               +-------------+     +-------------+     +-------------+
                 egress 1       ingress 3 - egress 6      ingress 5

------------------------------------------------------------------------

               +-------------+     +-------------+     +-------------+
               |  Core AS X  |     |   AS Y      |     |     AS Z    |
               |            1#-----#3-----------5#-----#1            |
path segment 4 |             |     |             |     |             |
               |            2#     #2           6#     #5            |
               |             |     |             |     |             |
               +-------------+     +-------------+     +-------------+
                 egress 1       ingress 3 - egress 5      ingress 1

</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-possible-up-or-down-segment" class="selfRef">Possible up- or down-segments for AS Z</a>
            </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="pcbs">
<section id="section-2.2">
        <h3 id="name-path-segment-construction-b">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-path-segment-construction-b" class="section-name selfRef">Path-Segment Construction Beacons (PCBs)</a>
        </h3>
<p id="section-2.2-1">This section provides a detailed specification of a single PCB and its message format.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<div id="pcb-compos">
<section id="section-2.2.1">
          <h4 id="name-components-of-a-pcb-in-mess">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-components-of-a-pcb-in-mess" class="section-name selfRef">Components of a PCB in Message Format</a>
          </h4>
<p id="section-2.2.1-1"><a href="#_figure-5" class="auto internal xref">Figure 7</a> graphically represents the PCB message format:<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<span id="name-top-down-composition-of-one"></span><div id="_figure-5">
<figure id="figure-7">
            <div class="alignLeft art-text artwork" id="section-2.2.1-2.1">
<pre>
                              PCB / PATH SEGMENT

+-------------+------------+------------+--------+--------------------+
|Segment Info | AS Entry 0 | AS Entry 1 |  ...   |     AS Entry N     |
+-------------+------------+------------+--------+--------------------+
*- - - - # - -*            *- - - # - - *
         |                        |
*- - - - v - - - *                |
+---------+------+                |
|Timestamp|Seg ID|                |
+---------+------+                |
                                  |
*- - - - - - - - - - - - - - - - -v- - - - - - - - - - - - - - - - - - *
+-----------------------+----------------------------------------------+
|    Unsigned Ext.      |               Signed AS Entry                |
+-----------------------+----------------------------------------------+
                        *- - - - - - - - - - - - # - - - - - - - - - - *
                                                 |
                                                 |
*- - - - - - - - - - - - - - - - - - - - - - - - v - - - - - - - - - - *
+--------------------+-----------------++------------------------------+
|     Signature      |    Header       ||                    Body      |
+--------------------+-----------------++------------------------------+
                     *- - - - # - - - -**- - - - - - - - # - - - - - - *
                              |                          |
*- - - - - - - - - - - - - - -v- - - - *                 |
+----------------+---------------------+                 |
| Signature Alg. | Verification Key ID |                 |
+----------------+---------------------+                 |
                 *- - - - - # - - - - -*                 |
                            |                            |
*- - - - - - - - - - - - - -v- - - - - - - - - -*        |
+---------+---------+------------+--------------+        |
| ISD-AS  |TRC Base | TRC Serial |Subject Key ID|        |
+---------+---------+------------+--------------+        |
                                                         |
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - v - - - - - - *
+------+-----------+---------++------------+----+------------++---+----+
|ISD-AS|Next ISD-AS|Hop Entry||Peer Entry 0| ...|Peer Entry N||MTU|Ext.|
+------+-----------+---------++------------+----+------------++---+----+
                   *- - # - -**- - - # - - *
                        |            |
                        |            |
*- - - - - - - - - - - -v- *  *- - - v - - - - - - - - - - - - - - - - *
+-------------+------------+  +--------+--------+----------+-----------+
| Ingress MTU | Hop Field  |  |HopField|PeerMTU |PeerISD-AS|PeerInterf.|
+-------------+--------+---+  +----+---+--------+----------+-----------+
                       *- - -#- - -*
                             |
                             |
*- - - - - - - - - - - - - - v - - - - - - - - - - - - - - *
+------------+-------------+-------------------+-----------+
|  Ingress   |    Egress   |  Expiration Time  |   MAC     |
+------------+-------------+-------------------+-----------+
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-top-down-composition-of-one" class="selfRef">Top-down composition of one PCB</a>
            </figcaption></figure>
</div>
<p id="section-2.2.1-3">The following sections provide detailed specifications of the PCB messages, starting with the top-level message of one PCB, and then diving deeper into each of the PCB's message components.<a href="#section-2.2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1-4"><strong>Note:</strong> For a full example of one PCB in the Protobuf message format, please see <a href="#app-a" class="auto internal xref">Appendix "Control Service gRPC API"</a>.<a href="#section-2.2.1-4" class="pilcrow">¶</a></p>
<div id="segment">
<section id="section-2.2.1.1">
            <h5 id="name-pcb-top-level-message-forma">
<a href="#section-2.2.1.1" class="section-number selfRef">2.2.1.1. </a><a href="#name-pcb-top-level-message-forma" class="section-name selfRef">PCB Top-Level Message Format</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-2.2.1.1-1">
<pre>
+-------------+-------------+------------+------+------------+
|Segment Info | AS Entry 0  | AS Entry 1 |  ... | AS Entry N |
+-------------+-------------+------------+------+------------+
</pre><a href="#section-2.2.1.1-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.1-2">Each PCB <span class="bcp14">MUST</span> consists of at least:<a href="#section-2.2.1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1.1-3.1">
                <p id="section-2.2.1.1-3.1.1">An information field with an identifier and a timestamp.<a href="#section-2.2.1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.1-3.2">
                <p id="section-2.2.1.1-3.2.1">Entries of all ASes on the path segment represented by this PCB.<a href="#section-2.2.1.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.2.1.1-4">The following code block defines the PCB on top level in Protobuf message format.<a href="#section-2.2.1.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.1-5">
<pre>
   message PathSegment {
       bytes segment_info = 1;
       repeated ASEntry as_entries = 2;
   }
</pre><a href="#section-2.2.1.1-5" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1.1-6.1">
                <p id="section-2.2.1.1-6.1.1"><code>segment_info</code>: This field is used as input for the PCB signature. It is the encoded version of the component <code>SegmentInformation</code>, which provides basic information about the PCB.  The <code>SegmentInformation</code> component is specified in detail in <a href="#seginfo" class="auto internal xref">Section 2.2.1.2</a>.<a href="#section-2.2.1.1-6.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.1-6.2">
                <p id="section-2.2.1.1-6.2.1"><code>as_entries</code>: Contains the <code>ASEntry</code> component of all ASes on the path segment represented by this PCB.<a href="#section-2.2.1.1-6.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1.1-6.2.2.1">
                    <p id="section-2.2.1.1-6.2.2.1.1"><code>ASEntry</code>: The <code>ASEntry</code> component contains the complete path information of a specific AS that is part of the path segment represented by the PCB. The <code>ASEntry</code> component is specified in detail in <a href="#ase-message" class="auto internal xref">Section 2.2.1.3</a>.<a href="#section-2.2.1.1-6.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</section>
</div>
<div id="seginfo">
<section id="section-2.2.1.2">
            <h5 id="name-segment-information">
<a href="#section-2.2.1.2" class="section-number selfRef">2.2.1.2. </a><a href="#name-segment-information" class="section-name selfRef">Segment Information</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-2.2.1.2-1">
<pre>
+----------------------------+
|         Segment Info       |
+----------------------------+
*- - - - - - - # - - - - - - *
               |
               |
*- - - - - - - v - - - - - - *
+--------------+-------------+
|   Timestamp  |   Seg ID    |
+--------------+-------------+
</pre><a href="#section-2.2.1.2-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.2-2">Each PCB <span class="bcp14">MUST</span> include an information component with basic information about the PCB.<a href="#section-2.2.1.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1.2-3">In the Protobuf message format, the information component of a PCB is called the <code>SegmentInformation</code> message. The following code block shows the Protobuf message definition for the <code>SegmentInformation</code> message.<a href="#section-2.2.1.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.2-4">
<pre>
   message SegmentInformation {
       int64 timestamp = 1;
       uint32 segment_id = 2;
   }
</pre><a href="#section-2.2.1.2-4" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1.2-5.1">
                <p id="section-2.2.1.2-5.1.1"><code>timestamp</code>: The 32-bit timestamp indicates the creation time of this PCB. It is set by the originating core AS. The expiration time of each hop field in the PCB is computed relative to this timestamp. The timestamp is encoded as the number of seconds elapsed since the POSIX Epoch (1970-01-01 00:00:00 UTC).<a href="#section-2.2.1.2-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.2-5.2">
                <p id="section-2.2.1.2-5.2.1"><code>segment_id</code>: The 16-bit identifier of this PCB and the corresponding path segment. The segment ID is <span class="bcp14">REQUIRED</span> for the computation of the message authentication code (MAC) of an AS's hop field. The MAC is used for hop field verification in the data plane. The originating core AS <span class="bcp14">MUST</span> fill this field with a cryptographically random number.<a href="#section-2.2.1.2-5.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.2.1.2-6"><strong>Note:</strong> See <a href="#hopfield" class="auto internal xref">Section 2.2.1.6</a> for more information on the hop field message format. <span>[<a href="#I-D.scion-dp" class="cite xref">I-D.scion-dp</a>]</span> provides a detailed description of the computation of the MAC and the verification of the hop field in the data plane.<a href="#section-2.2.1.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ase-message">
<section id="section-2.2.1.3">
            <h5 id="name-as-entry">
<a href="#section-2.2.1.3" class="section-number selfRef">2.2.1.3. </a><a href="#name-as-entry" class="section-name selfRef">AS Entry</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-2.2.1.3-1">
<pre>
                           +--------------+
                           |  AS Entry    |
                           +--------------+
                           *- - - -#- - - *
                                   |
                                   |
                                   |
*- - - - - - - - - - - - - - - - - v - - - - - - - - - - - - - - - *
+-----------------------+------------------------------------------+
|    Unsigned Ext.      |          Signed AS Entry                 |
+-----------------------+------------------------------------------+
</pre><a href="#section-2.2.1.3-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.3-2">Beside the basic information component, each PCB <span class="bcp14">MUST</span> also contain the entries of all ASes included in the corresponding path segment. This means that the originating core AS <span class="bcp14">MUST</span> add its AS entry to each PCB it creates. During the beaconing process, also each traversed AS <span class="bcp14">MUST</span> attach its AS entry to the PCB.<a href="#section-2.2.1.3-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1.3-3">One AS entry contains the complete hop information for this specific AS in this specific path segment. It consists of a signed and an unsigned component.<a href="#section-2.2.1.3-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1.3-4">The code block below defines an AS entry <code>ASEntry</code> in Protobuf message format.<a href="#section-2.2.1.3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.3-5">
<pre>
   message ASEntry {
       SignedMessage signed = 1;
       PathSegmentUnsignedExtensions unsigned = 2;
   }
</pre><a href="#section-2.2.1.3-5" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.3-6">It includes the following components:<a href="#section-2.2.1.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1.3-7.1">
                <p id="section-2.2.1.3-7.1.1"><code>SignedMessage</code>: The signed component of an AS entry. For the specification of this part of the AS entry, see <a href="#signed-compo" class="auto internal xref">Section 2.2.1.4</a> below.<a href="#section-2.2.1.3-7.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.3-7.2">
                <p id="section-2.2.1.3-7.2.1"><code>PathSegmentUnsignedExtensions</code>: The unsigned and thus unprotected part of the AS entry. These are extensions with metadata that need no explicit protection.<a href="#section-2.2.1.3-7.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="signed-compo">
<section id="section-2.2.1.4">
            <h5 id="name-as-entry-signed-component">
<a href="#section-2.2.1.4" class="section-number selfRef">2.2.1.4. </a><a href="#name-as-entry-signed-component" class="section-name selfRef">AS Entry Signed Component</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-2.2.1.4-1">
<pre>
        +------------------------------------------------------+
        |                   Signed AS Entry                    |
        +------------------------------------------------------+
        *- - - - - - - - - - - - -#- - - - - - - - - - - - - - *
                                  |
                                  |
*- - - - - - - - - - - - - - - - -v- - - - - - - - - - - - - - - - - -*
+--------------------+-----------------+------------------------------+
|      Header        |     Body        |            Signature         |
+--------------------+-----------------+------------------------------+
</pre><a href="#section-2.2.1.4-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.4-2">Each AS entry of a PCB <span class="bcp14">MUST</span> include a signed component as well as a signature computed over the signed component. Each AS entry <span class="bcp14">MUST</span> be signed with a private key that corresponds to the public key certified by the AS's certificate.<a href="#section-2.2.1.4-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1.4-3">This section specifies the signed component of an AS entry. The signed component of an AS entry <span class="bcp14">MUST</span> include the following elements:<a href="#section-2.2.1.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1.4-4.1">
                <p id="section-2.2.1.4-4.1.1">a header,<a href="#section-2.2.1.4-4.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.4-4.2">
                <p id="section-2.2.1.4-4.2.1">a body, and<a href="#section-2.2.1.4-4.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.4-4.3">
                <p id="section-2.2.1.4-4.3.1">a signature.<a href="#section-2.2.1.4-4.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.2.1.4-5">In the Protobuf message-format implementation, the signed component of an AS entry is specified by the <code>SignedMessage</code>. It consists of a header-and-body part (<code>header_and_body</code>) and a raw signature (<code>signature</code>). See also the code block below.<a href="#section-2.2.1.4-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.4-6">
<pre>
   message SignedMessage {
       bytes header_and_body = 1;
       bytes signature = 2;
   }
</pre><a href="#section-2.2.1.4-6" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.4-7">The following code block shows the low-level representation of the <code>HeaderAndBodyInternal</code> message used for signature computation input. This message <span class="bcp14">SHOULD NOT</span> be used by external code.<a href="#section-2.2.1.4-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.4-8">
<pre>
   message HeaderAndBodyInternal {
       // Encoded header suitable for signature computation.
       bytes header = 1;
       // Raw payload suitable for signature computation.
       bytes body = 2;
   }
</pre><a href="#section-2.2.1.4-8" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1.4-9.1">
                <p id="section-2.2.1.4-9.1.1">For the specification of the signed header, see <a href="#ase-header" class="auto internal xref">Section 2.2.1.4.1</a>.<a href="#section-2.2.1.4-9.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.4-9.2">
                <p id="section-2.2.1.4-9.2.1">For the specification of the signed body, see <a href="#ase-sign" class="auto internal xref">Section 2.2.1.4.2</a>.<a href="#section-2.2.1.4-9.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.4-9.3">
                <p id="section-2.2.1.4-9.3.1">For the specification of the <code>signature</code> field, see <a href="#sign" class="auto internal xref">Section 2.2.1.4.3</a>.<a href="#section-2.2.1.4-9.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<div id="ase-header">
<section id="section-2.2.1.4.1">
              <h6 id="name-as-entry-signed-header">
<a href="#section-2.2.1.4.1" class="section-number selfRef">2.2.1.4.1. </a><a href="#name-as-entry-signed-header" class="section-name selfRef">AS Entry Signed Header</a>
              </h6>
<div class="alignLeft art-text artwork" id="section-2.2.1.4.1-1">
<pre>
           +-----------------+
           |     Header      |
           +-----------------+
           *- - - - # - - - -*
                    |
 - - - - - - - - - -v- - - - - - - - - *
+----------------+---------------------+
| Signature Alg. | Verification Key ID |
+----------------+---------------------+
                 *- - - - - # - - - - -*
                            |
 - - - - - - - - - - - - - -v- - - - - - - - - -
+---------+---------+------------+--------------+
| ISD-AS  |TRC Base | TRC Serial |Subject Key ID|
+---------+---------+------------+--------------+
</pre><a href="#section-2.2.1.4.1-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.4.1-2">The header part defines metadata that is relevant to (the computation and verification of) the signature. It <span class="bcp14">MUST</span> include at least the following metadata:<a href="#section-2.2.1.4.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1.4.1-3.1">
                  <p id="section-2.2.1.4.1-3.1.1">The algorithm to compute the signature<a href="#section-2.2.1.4.1-3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.1-3.2">
                  <p id="section-2.2.1.4.1-3.2.1">The identifier of the public key used to verify the signature (i.e., the public key certified by the AS's certificate)<a href="#section-2.2.1.4.1-3.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.1-3.3">
                  <p id="section-2.2.1.4.1-3.3.1">The ISD-AS number of the AS<a href="#section-2.2.1.4.1-3.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="section-2.2.1.4.1-4">The following code block defines the signed header of an AS entry in Protobuf message format (called the <code>Header</code> message).<a href="#section-2.2.1.4.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.4.1-5">
<pre>
   message Header {
       SignatureAlgorithm signature_algorithm = 1;
       bytes verification_key_id = 2;
       // Optional
       google.protobuf.Timestamp timestamp = 3;
       // Optional
       bytes metadata = 4;
       int32 associated_data_length = 5;
   }

   message VerificationKeyID {
       uint64 isd_as = 1;
       bytes subject_key_id = 2;
       uint64 trc_base = 3;
       uint64 trc_serial = 4;
   }
</pre><a href="#section-2.2.1.4.1-5" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1.4.1-6.1">
                  <p id="section-2.2.1.4.1-6.1.1"><code>signature_algorithm</code>: Specifies the algorithm to compute the signature.<a href="#section-2.2.1.4.1-6.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.1-6.2">
                  <p id="section-2.2.1.4.1-6.2.1"><code>verification_key_id</code>: Holds the serialized data defined by the <code>VerificationKeyID</code> message type. The <code>VerificationKeyID</code> message contains more information that is relevant to signing and verifying PCBs and other control-plane messages. The <code>VerificationKeyID</code> message type includes the following fields (see also the above code block):<a href="#section-2.2.1.4.1-6.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1.4.1-6.2.2.1">
                      <p id="section-2.2.1.4.1-6.2.2.1.1"><code>isd_as</code>: The ISD-AS number of the current AS.<a href="#section-2.2.1.4.1-6.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-2.2.1.4.1-6.2.2.2">
                      <p id="section-2.2.1.4.1-6.2.2.2.1"><code>subject_key_id</code>: Refers to the certificate that contains the public key needed to verify this PCB's signature.<a href="#section-2.2.1.4.1-6.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-2.2.1.4.1-6.2.2.3">
                      <p id="section-2.2.1.4.1-6.2.2.3.1"><code>trc_base</code>: Defines the <em>base</em> number of the latest Trust Root Configuration (TRC) available to the signer at the time of the signature creation.<a href="#section-2.2.1.4.1-6.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-2.2.1.4.1-6.2.2.4">
                      <p id="section-2.2.1.4.1-6.2.2.4.1"><code>trc_serial</code>: Defines the <em>serial</em> number of the latest TRC available to the signer at the time of the signature creation.<a href="#section-2.2.1.4.1-6.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
<p id="section-2.2.1.4.1-7"><strong>Note:</strong> For more information on signing and verifying control-plane messages (such as PCBs), see the chapter Signing and Verifying Control-Plane Messages of the SCION Control-Plane PKI Specification <span>[<a href="#I-D.scion-cppki" class="cite xref">I-D.scion-cppki</a>]</span>. For more information on the TRC base and serial number, see the chapter Trust Root Configuration Specification of the SCION Control-Plane PKI Specification <span>[<a href="#I-D.scion-cppki" class="cite xref">I-D.scion-cppki</a>]</span>.<a href="#section-2.2.1.4.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1.4.1-8.1">
                  <p id="section-2.2.1.4.1-8.1.1"><code>timestamp</code>: Defines the signature creation timestamp. This field is <span class="bcp14">OPTIONAL</span>.<a href="#section-2.2.1.4.1-8.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.1-8.2">
                  <p id="section-2.2.1.4.1-8.2.1"><code>metadata</code>: Can be used to include arbitrary per-protocol metadata. This field is <span class="bcp14">OPTIONAL</span>.<a href="#section-2.2.1.4.1-8.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.1-8.3">
                  <p id="section-2.2.1.4.1-8.3.1"><code>associated_data_length</code>: Specifies the length of associated data that is covered by the signature, but is not included in the header and body. The value of this field is zero, if no associated data is covered by the signature.<a href="#section-2.2.1.4.1-8.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</section>
</div>
<div id="ase-sign">
<section id="section-2.2.1.4.2">
              <h6 id="name-as-entry-signed-body">
<a href="#section-2.2.1.4.2" class="section-number selfRef">2.2.1.4.2. </a><a href="#name-as-entry-signed-body" class="section-name selfRef">AS Entry Signed Body</a>
              </h6>
<div class="alignLeft art-text artwork" id="section-2.2.1.4.2-1">
<pre>
                +--------------------------------------+
                |                 Body                 |
                +--------------------------------------+
                *- - - - - - - - - -#- - - - - - - - - *
                                    |
                                    |
*- - - - - - - - - - - - - - - - - -v- - - - - - - - - - - - - - - - -*
+------+-----------+---------++------------+---+------------++---+----+
|ISD-AS|Next ISD-AS|Hop Entry||Peer Entry 0|...|Peer Entry N||MTU|Ext.|
+------+-----------+---------++------------+---+------------++---+----+
</pre><a href="#section-2.2.1.4.2-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.4.2-2">The body of an AS entry <span class="bcp14">MUST</span> consist of the signed component <code>ASEntrySignedBody</code> of all ASes in the path segment represented by the PCB, up until and including the current AS.<a href="#section-2.2.1.4.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1.4.2-3">The following code block defines the signed body of one AS entry in Protobuf message format (called the <code>ASEntrySignedBody</code> message).<a href="#section-2.2.1.4.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.4.2-4">
<pre>
   message ASEntrySignedBody {
       uint64 isd_as = 1;
       uint64 next_isd_as = 2;
       HopEntry hop_entry = 3;
       repeated PeerEntry peer_entries = 4;
       uint32 mtu = 5;
       PathSegmentExtensions extensions = 6;
   }
</pre><a href="#section-2.2.1.4.2-4" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1.4.2-5.1">
                  <p id="section-2.2.1.4.2-5.1.1"><code>isd_as</code>: The ISD-AS number of the AS that created this AS entry.<a href="#section-2.2.1.4.2-5.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.2-5.2">
                  <p id="section-2.2.1.4.2-5.2.1"><code>next_isd_as</code>: The ISD-AS number of the downstream AS to which the PCB <span class="bcp14">SHOULD</span> be forwarded.<a href="#section-2.2.1.4.2-5.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.2-5.3">
                  <p id="section-2.2.1.4.2-5.3.1"><code>hop_entry</code>: The hop entry (<code>HopEntry</code>) with the information required to forward this PCB through the current AS to the next AS. This information is used in the data plane. For a specification of the hop entry, see <a href="#hopentry" class="auto internal xref">Section 2.2.1.5</a>.<a href="#section-2.2.1.4.2-5.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.2-5.4">
                  <p id="section-2.2.1.4.2-5.4.1"><code>peer_entries</code>: The list of optional peer entries (<code>PeerEntry</code>). For a specification of one peer entry, see <a href="#peerentry" class="auto internal xref">Section 2.2.1.7</a>.<a href="#section-2.2.1.4.2-5.4.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.2-5.5">
                  <p id="section-2.2.1.4.2-5.5.1"><code>mtu</code>: The size of the maximum transmission unit (MTU) within the current AS's network.<a href="#section-2.2.1.4.2-5.5.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.2-5.6">
                  <p id="section-2.2.1.4.2-5.6.1"><code>extensions</code>: List of (signed) extensions (optional). PCB extensions defined here are part of the signed AS entry. This field <span class="bcp14">SHOULD</span> therefore only contain extensions that include important metadata for which cryptographic protection is required. For more information on PCB extensions, see <a href="#pcb-ext" class="auto internal xref">Section 2.2.2</a>.<a href="#section-2.2.1.4.2-5.6.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</section>
</div>
<div id="sign">
<section id="section-2.2.1.4.3">
              <h6 id="name-as-entry-signature">
<a href="#section-2.2.1.4.3" class="section-number selfRef">2.2.1.4.3. </a><a href="#name-as-entry-signature" class="section-name selfRef">AS Entry Signature</a>
              </h6>
<p id="section-2.2.1.4.3-1">Each AS entry <span class="bcp14">MUST</span> be signed with the AS certificate's private key K<sub>i</sub>. The certificate <span class="bcp14">MUST</span> have a validity period fully containing that of the segment being verified; regardless of current time. The signature Sig<sub>i</sub> of an AS entry ASE<sub>i</sub> is computed over the AS entry's signed component. This is the input for the computation of the signature:<a href="#section-2.2.1.4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1.4.3-2.1">
                  <p id="section-2.2.1.4.3-2.1.1">The signed header and body of the current AS (<code>header_and_body</code>).<a href="#section-2.2.1.4.3-2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.3-2.2">
                  <p id="section-2.2.1.4.3-2.2.1">The <code>segment_info</code> component of the current AS. This is the encoded version of the <code>SegmentInformation</code> component containing basic information about the path segment represented by the PCB. For the specification of <code>SegmentInformation</code>, see <a href="#seginfo" class="auto internal xref">Section 2.2.1.2</a>.<a href="#section-2.2.1.4.3-2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.1.4.3-2.3">
                  <p id="section-2.2.1.4.3-2.3.1">The signed <code>header_and_body</code>/<code>signature</code> combination of each previous AS on this specific path segment.<a href="#section-2.2.1.4.3-2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="section-2.2.1.4.3-3">The signature Sig<sub>i</sub> of an AS entry ASE<sub>i</sub> is now computed as follows:<a href="#section-2.2.1.4.3-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1.4.3-4">Sig<sub>i</sub> =
K<sub>i</sub>( SegInfo || ASE<sub>0</sub><sup>(signed)</sup> || Sig<sub>0</sub> || ... || ASE<sub>i-1</sub><sup>(signed)</sup> || Sig<sub>i-1</sub> || ASE<sub>i</sub><sup>(signed)</sup> )<a href="#section-2.2.1.4.3-4" class="pilcrow">¶</a></p>
<p id="section-2.2.1.4.3-5">The signature metadata minimally contains the ISD-AS number of the signing entity and the key identifier of the public key to be used to verify the message. For more information on signing and verifying control-plane messages, see the chapter "Signing and Verifying Control-Plane Messages" of the SCION Control-Plane PKI Specification <span>[<a href="#I-D.scion-cppki" class="cite xref">I-D.scion-cppki</a>]</span>.<a href="#section-2.2.1.4.3-5" class="pilcrow">¶</a></p>
<p id="section-2.2.1.4.3-6">The following code block shows how the signature input is defined in the SCION Protobuf implementation ("ps" stands for path segment). Note that the signature has a nested structure.<a href="#section-2.2.1.4.3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.4.3-7">
<pre>
input(ps, i) = signed.header_and_body || associated_data(ps, i)

associated_data(ps, i) = ps.segment_info ||
                         ps.as_entries[1].signed.header_and_body ||
                         ps.as_entries[1].signed.signature ||
                         ...
                         ps.as_entries[i-1].signed.header_and_body ||
                         ps.as_entries[i-1].signed.signature
</pre><a href="#section-2.2.1.4.3-7" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="hopentry">
<section id="section-2.2.1.5">
            <h5 id="name-hop-entry">
<a href="#section-2.2.1.5" class="section-number selfRef">2.2.1.5. </a><a href="#name-hop-entry" class="section-name selfRef">Hop Entry</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-2.2.1.5-1">
<pre>
       +-----------+
       | Hop Entry |
       +-----------+
       *- - -#- - -*
             |
 - - - - - - v - - - - - - *
+-------------+------------+
| Ingress MTU | Hop Field  |
+-------------+------------+
</pre><a href="#section-2.2.1.5-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.5-2">Each body of an AS entry <span class="bcp14">MUST</span> contain exactly one hop entry component. The hop entry component specifies forwarding information for the data plane. The data plane requires this information to create the hop through the current AS (in the direction of the beaconing).<a href="#section-2.2.1.5-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1.5-3">The following code block defines the hop entry component <code>HopEntry</code> in Protobuf message format:<a href="#section-2.2.1.5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.5-4">
<pre>
   message HopEntry {
       HopField hop_field = 1;
       uint32 ingress_mtu = 2;
   }
</pre><a href="#section-2.2.1.5-4" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1.5-5.1">
                <p id="section-2.2.1.5-5.1.1"><code>hop_field</code>: Contains the authenticated information about the ingress and egress interfaces in the direction of beaconing. The data plane needs this information to forward packets through the current AS. For further specifications, see <a href="#hopfield" class="auto internal xref">Section 2.2.1.6</a>.<a href="#section-2.2.1.5-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.5-5.2">
                <p id="section-2.2.1.5-5.2.1"><code>ingress_mtu</code>: Specifies the maximum transmission unit (MTU) of the ingress interface of the current AS.<a href="#section-2.2.1.5-5.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="hopfield">
<section id="section-2.2.1.6">
            <h5 id="name-hop-field">
<a href="#section-2.2.1.6" class="section-number selfRef">2.2.1.6. </a><a href="#name-hop-field" class="section-name selfRef">Hop Field</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-2.2.1.6-1">
<pre>
                      +-----------+
                      | Hop Field |
                      +-----------+
                      *- - -#- - -*
                            |
                            |
*- - - - - - - - - - - - - -v- - - - - - - - - - - - - - - *
+-------------+-------------+-------------------+----------+
|   Ingress   |    Egress   |  Expiration Time  |   MAC    |
+-------------+-------------+-------------------+----------+
</pre><a href="#section-2.2.1.6-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.6-2">The hop field, part of both hop entries and peer entries, is used directly in the data plane for packet forwarding: It specifies the incoming and outgoing interfaces of the ASes on the forwarding path. To prevent forgery, this information is authenticated with a message authentication code (MAC), which will be checked by the SCION border routers during packet forwarding.<a href="#section-2.2.1.6-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1.6-3">The algorithm used to compute the hop field MAC is an AS-specific choice. The operator of an AS can freely choose a MAC algorithm without outside coordination. However, the control service and routers of the AS do need to agree on the algorithm used.
Control service and router implementations <span class="bcp14">MUST</span> support the Default Hop Field MAC algorithm described in <span>[<a href="#I-D.scion-dp" class="cite xref">I-D.scion-dp</a>]</span>. This document does not specify any further mechanism to coordinate this choice between control services and routers of one AS.<a href="#section-2.2.1.6-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1.6-4">The following code block defines the hop field component <code>HopField</code> in Protobuf message format:<a href="#section-2.2.1.6-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.6-5">
<pre>
   message HopField {
       uint64 ingress = 1;
       uint64 egress = 2;
       uint32 exp_time = 3;
       bytes mac = 4;
   }
</pre><a href="#section-2.2.1.6-5" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1.6-6.1">
                <p id="section-2.2.1.6-6.1.1"><code>ingress</code>: The 16-bit ingress interface identifier (in the direction of the path construction, that is, in the direction of beaconing through the current AS).<a href="#section-2.2.1.6-6.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.2.1.6-7"><strong>Note:</strong> For the AS that initiates the PCB, the ingress interface identifier <span class="bcp14">MUST NOT</span> be specified. This initiating AS is a core AS.<a href="#section-2.2.1.6-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1.6-8.1">
                <p id="section-2.2.1.6-8.1.1"><code>egress</code>: The 16-bit egress interface identifier (in the direction of beaconing).<a href="#section-2.2.1.6-8.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.6-8.2">
                <p id="section-2.2.1.6-8.2.1"><code>exp_time</code>: The 8-bit encoded expiration time of the hop field, indicating its validity. This field expresses a duration in seconds according to the formula: <code>duration = (1 + exp_time) * (24*60*60/256)</code>. The minimum duration is therefore 337.5 s. This duration is relative to the PCB creation timestamp set in the PCB's segment information component (see also <a href="#seginfo" class="auto internal xref">Section 2.2.1.2</a>). Therefore, the absolute expiration time of the hop field is the sum of these two values.<a href="#section-2.2.1.6-8.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.6-8.3">
                <p id="section-2.2.1.6-8.3.1"><code>mac</code>: The message authentication code (MAC) used in the data plane to verify the hop field, as described in <span>[<a href="#I-D.scion-dp" class="cite xref">I-D.scion-dp</a>]</span>.<a href="#section-2.2.1.6-8.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="peerentry">
<section id="section-2.2.1.7">
            <h5 id="name-peer-entry">
<a href="#section-2.2.1.7" class="section-number selfRef">2.2.1.7. </a><a href="#name-peer-entry" class="section-name selfRef">Peer Entry</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-2.2.1.7-1">
<pre>
                      +--------------+
                      |  Peer Entry  |
                      +--------------+
                      *- - - -#- - - *
                              |
*- - - - - - - - - - - - - - -v- - - - - - - - - - - - - - *
+-------------+------------+--------------+----------------+
|  Hop Field  |  Peer MTU  | Peer ISD-AS  | Peer Interface |
+-------------+------------+--------------+----------------+
</pre><a href="#section-2.2.1.7-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.7-2">By means of a peer entry, an AS can announce that it has a peering link to another AS. A peer entry is an optional component of a PCB - it is only included if there is a peering link to a peer AS.<a href="#section-2.2.1.7-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1.7-3">The following code block defines the peer entry component <code>PeerEntry</code> in Protobuf message format:<a href="#section-2.2.1.7-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.1.7-4">
<pre>
   message PeerEntry {
       uint64 peer_isd_as = 1;
       uint64 peer_interface = 2;
       uint32 peer_mtu = 3;
       HopField hop_field = 4;
   }
</pre><a href="#section-2.2.1.7-4" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1.7-5.1">
                <p id="section-2.2.1.7-5.1.1"><code>peer_isd_as</code>: The ISD-AS number of the peer AS. This number is used to match peering segments during path construction.<a href="#section-2.2.1.7-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.7-5.2">
                <p id="section-2.2.1.7-5.2.1"><code>peer_interface</code>: The 16-bit interface identifier of the peering link on the peer AS side. This identifier is used to match peering segments during path construction.<a href="#section-2.2.1.7-5.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.7-5.3">
                <p id="section-2.2.1.7-5.3.1"><code>peer_mtu</code>: Specifies the maximum transmission unit MTU on the peering link.<a href="#section-2.2.1.7-5.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.1.7-5.4">
                <p id="section-2.2.1.7-5.4.1"><code>hop_field</code>: Contains the authenticated information about the ingress and egress interfaces in the current AS (coming from the peering link, in the direction of beaconing - see also <a href="#_figure-6" class="auto internal xref">Figure 8</a>). The data plane needs this information to forward packets through the current AS. For further specifications, see <a href="#hopfield" class="auto internal xref">Section 2.2.1.6</a>.<a href="#section-2.2.1.7-5.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<span id="name-peer-entry-information-in-t"></span><div id="_figure-6">
<figure id="figure-8">
              <div class="alignLeft art-text artwork" id="section-2.2.1.7-6.1">
<pre>
   +-----------+
   |           |
   | parent AS |
   |           |
   +-----------+
         |
         |
         | ASE.HF.ingress_interface
+--------#-----------+                  +-----------------+
|        |           |         PE.peer_ |                 |
|                    |         interface|                 |
|        | + - - - - #------------------#     peer AS     |
|                    |PE.HF.ingress_    |                 |
|        | |         |interface         |                 |
|                    |                  +-----------------+
|        v v         |
+---------#----------+
          | PE.HF.egress_interface
          | ASE.HF.egress_interface
          |
          |
    +-----------+
    |           |
    |  child AS |
    |           |
    +-----------+
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-peer-entry-information-in-t" class="selfRef">Peer entry information, in the direction of beaconing</a>
              </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="pcb-ext">
<section id="section-2.2.2">
          <h4 id="name-pcb-extensions">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-pcb-extensions" class="section-name selfRef">PCB Extensions</a>
          </h4>
<p id="section-2.2.2-1">In addition to basic routing information like hop entries and peer entries, PCBs can be used to communicate additional metadata, in its extensions. Extensions can be signed and unsigned. Signed extensions are protected by the AS signature, whereas unsigned extensions are not.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2-2">On code-level and in Protobuf message format, extensions are specified as follows:<a href="#section-2.2.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.2-3.1">
              <p id="section-2.2.2-3.1.1">Unsigned extensions <code>PathSegmentUnsignedExtensions</code> are part of the AS entry component (the <code>ASEntry</code> message, see also <a href="#ase-message" class="auto internal xref">Section 2.2.1.3</a>).<a href="#section-2.2.2-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-3.2">
              <p id="section-2.2.2-3.2.1">Signed extensions <code>PathSegmentExtensions</code> are part of the signed body component of an AS entry (the <code>ASEntrySignedBody</code> message, see also <a href="#ase-sign" class="auto internal xref">Section 2.2.1.4.2</a>).<a href="#section-2.2.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.2.2-4"><strong>Note:</strong> SCION also supports so-called "detachable extensions". The detachable extension itself is part of a PCB's unsigned extensions, but a cryptographic hash of the detachable extension data is added to the signed extensions. Thus, a PCB with a detachable extension can be signed and verified without actually including the detachable extension in the signature. This prevents a possible processing overhead caused by large cryptographically-protected extensions.<a href="#section-2.2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pcb-validity">
<section id="section-2.2.3">
          <h4 id="name-pcb-validity">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-pcb-validity" class="section-name selfRef">PCB Validity</a>
          </h4>
<p id="section-2.2.3-1">To be valid (that is, usable to construct a valid path), a PCB <span class="bcp14">MUST</span>:<a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.3-2.1">
              <p id="section-2.2.3-2.1.1">Contain valid AS Entry signatures (<a href="#sign" class="auto internal xref">Section 2.2.1.4.3</a>).<a href="#section-2.2.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.3-2.2">
              <p id="section-2.2.3-2.2.1">Have a timestamp (<a href="#seginfo" class="auto internal xref">Section 2.2.1.2</a>) that is not in the future.<a href="#section-2.2.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.3-2.3">
              <p id="section-2.2.3-2.3.1">Contain only unexpired hops (<a href="#hopfield" class="auto internal xref">Section 2.2.1.6</a>).<a href="#section-2.2.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.2.3-3">For the purpose of validation, a timestamp is considered "future" if it is later than the current time at the point of validation plus the minimum expiration time of a hop field (337.5 seconds, see <a href="#hopfield" class="auto internal xref">Section 2.2.1.6</a>).<a href="#section-2.2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.2.3-4">For the purpose of validation, a hop is considered expired if its absolute expiration time, calculated as defined in <a href="#hopfield" class="auto internal xref">Section 2.2.1.6</a>, is later than the current time at the point of validation.<a href="#section-2.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="configuration">
<section id="section-2.2.4">
          <h4 id="name-configuration">
<a href="#section-2.2.4" class="section-number selfRef">2.2.4. </a><a href="#name-configuration" class="section-name selfRef">Configuration</a>
          </h4>
<p id="section-2.2.4-1">For the purpose of constructing and propagating path segments, an AS control service <span class="bcp14">MUST</span> be configured with links to neighboring ASes. Such information may be conveyed to the control service in an out of band fashion (e.g in a configuration file). For each link, these values <span class="bcp14">MUST</span> be configured:<a href="#section-2.2.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.4-2.1">
              <p id="section-2.2.4-2.1.1">Local interface ID<a href="#section-2.2.4-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.4-2.2">
              <p id="section-2.2.4-2.2.1">Neighbor type (core, parent, child, peer), depending on link type (see <a href="#paths-links" class="auto internal xref">Section 1.3</a>). Link type depends on mutual agreements between the organizations operating the ASes at each end of each link.<a href="#section-2.2.4-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.4-2.3">
              <p id="section-2.2.4-2.3.1">Neighbor ISD-AS number<a href="#section-2.2.4-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.4-2.4">
              <p id="section-2.2.4-2.4.1">Neighbor interface underlay address<a href="#section-2.2.4-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="path-prop">
<section id="section-2.3">
        <h3 id="name-propagation-of-pcbs">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-propagation-of-pcbs" class="section-name selfRef">Propagation of PCBs</a>
        </h3>
<p id="section-2.3-1">This section describes how PCBs are selected and propagated in the path exploration process.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<div id="selection">
<section id="section-2.3.1">
          <h4 id="name-selection-of-pcbs-to-propag">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-selection-of-pcbs-to-propag" class="section-name selfRef">Selection of PCBs to Propagate</a>
          </h4>
<p id="section-2.3.1-1">As an AS receives a series of intra-ISD or core PCBs, it <span class="bcp14">MUST</span> select the PCBs it will use to continue beaconing. Each AS specifies a local policy on the basis of which PCBs are evaluated, selected, or eliminated.
The selection process can inspect and compare the properties of the candidate PCBs (e.g., length, disjointness across different paths, age, expiration time) and/or take into account which PCBs have been propagated in the past.<a href="#section-2.3.1-1" class="pilcrow">¶</a></p>
<p id="section-2.3.1-2">Naturally, an AS's policy selects PCBs corresponding to paths that are commercially or otherwise operationally viable.
From these viable PCBs, only a relatively small subset <span class="bcp14">SHOULD</span> be propagated, to avoid excessive overhead of the path discovery system in bigger networks.
The goal of the AS <span class="bcp14">SHOULD</span> be to propagate those candidate PCBs with the highest probability of collectively meeting the needs of the endpoints that will perform path construction. As SCION does not provide any in-band signal about the intentions of endpoints nor about the policies of downstream ASes, the policy will typically select a somewhat diverse set optimized for multiple, generic parameters.<a href="#section-2.3.1-2" class="pilcrow">¶</a></p>
<div id="storing-and-selecting-candidate-pcbs">
<section id="section-2.3.1.1">
            <h5 id="name-storing-and-selecting-candi">
<a href="#section-2.3.1.1" class="section-number selfRef">2.3.1.1. </a><a href="#name-storing-and-selecting-candi" class="section-name selfRef">Storing and Selecting Candidate PCBs</a>
            </h5>
<p id="section-2.3.1.1-1">When receiving a PCB, an AS first stores the PCB in a temporary storage for candidate PCBs, called the <em>beacon store</em>.<a href="#section-2.3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-2.3.1.1-2">PCBs are propagated in batches to each connected downstream AS at a fixed frequency, the <em>propagation interval</em>. At each propagation event, each AS selects a set of the best PCBs from the candidates in the beacon store, according to the AS's selection policy. This set <span class="bcp14">SHOULD</span> have a fixed size, the <em>best PCBs set size</em>.<a href="#section-2.3.1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.1.1-3.1">
                <p id="section-2.3.1.1-3.1.1">The <em>best PCBs set size</em> <span class="bcp14">SHOULD</span> be at most "50" (PCBs) for intra-ISD beaconing and at most "5" (PCBs) for core beaconing.<a href="#section-2.3.1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.3.1.1-4">Depending on the selection criteria, it may be necessary to keep more candidate PCBs than the <em>best PCBs set size</em> in the beacon store, to be able to determine the best set of PCBs. If this is the case, an AS <span class="bcp14">SHOULD</span> have a suitable pre-selection of candidate PCBs in place, in order to keep the beacon store capacity limited.<a href="#section-2.3.1.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.1.1-5.1">
                <p id="section-2.3.1.1-5.1.1">The <em>propagation interval</em> <span class="bcp14">SHOULD</span> be at least "5" (seconds) for intra-ISD beaconing and at least "60" (seconds) for core beaconing.<a href="#section-2.3.1.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.3.1.1-6">Note that to ensure quick connectivity establishment, an AS <span class="bcp14">MAY</span> attempt to forward a PCB more frequently ("fast recovery"). Current practice is to increase the frequency of attempts if no PCB propagation is know to have succeeded within the last propagation interval:<a href="#section-2.3.1.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.1.1-7.1">
                <p id="section-2.3.1.1-7.1.1">because the corresponding RPC failed<a href="#section-2.3.1.1-7.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3.1.1-7.2">
                <p id="section-2.3.1.1-7.2.1">or because no beacon was available to propagate
The scalability implications of such parameters are further discussed in <a href="#scalability" class="auto internal xref">Section 2.4</a>.<a href="#section-2.3.1.1-7.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="selection-policy-example">
<section id="section-2.3.1.2">
            <h5 id="name-selection-policy-example">
<a href="#section-2.3.1.2" class="section-number selfRef">2.3.1.2. </a><a href="#name-selection-policy-example" class="section-name selfRef">Selection Policy Example</a>
            </h5>
<p id="section-2.3.1.2-1"><a href="#_figure-7" class="auto internal xref">Figure 9</a> below illustrates the selection of path segments in three networks. Each network uses a different path property to select path segments.<a href="#section-2.3.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.1.2-2.1">
                <p id="section-2.3.1.2-2.1.1">The network at the upper left considers the <em>path length</em>, which is here defined as the number of hops from the originator core AS to the local AS. This number can give an indication of the path's latency. Based on this criterion, the network will select the PCB representing path segment A-G (in direction of beaconing) to propagate.<a href="#section-2.3.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3.1.2-2.2">
                <p id="section-2.3.1.2-2.2.1">The network at the upper right uses <em>peering links</em> as the selection criterion, that is, the number of different peering ASes from all non-core ASes on the PCB or path segment: A greater number of peering ASes increases the likelihood of finding a shortcut on the path segment. Based on this criterion, the network will select the PCB representing path segment B-E-I-L (in direction of beaconing) to propagate.<a href="#section-2.3.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3.1.2-2.3">
                <p id="section-2.3.1.2-2.3.1">The lower network selects PCBs based on <em>disjointness</em>. The disjointness of a PCB is calculated relative to the PCBs that have been previously sent. Paths can be either AS-disjoint or link-disjoint. AS-disjoint paths have no common upstream/core AS for the current AS, whereas link-disjoint paths do not share any AS-to-AS link. Depending on the objective of the AS, both criteria can be used: AS-disjointness allows path diversity in the event that an AS becomes unresponsive, and link-disjointness provides resilience in case of link failure. Based on the disjointness criterion, the network will select the PCBs representing the path segments A-D-G-H-J and C-E-F-I-J (in direction of beaconing) to propagate.<a href="#section-2.3.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<span id="name-example-networks-to-illustr"></span><div id="_figure-7">
<figure id="figure-9">
              <div class="alignLeft art-text artwork" id="section-2.3.1.2-3.1">
<pre>
 Selected path segment: #------# or *------*
 Peering Link: PL

   ISD A: Path Length                 ISD B: Peering Links
+----------------------+          +---------------------------+
|      ISD Core        |          |        ISD Core           |
| .---.         .---.  |          |  .---.             .---.  |
|(  A  ) - - - (  C  ) |          | (  A  ) - - - - - (  C  ) |
| `-#-'         `---'  |       + --- `---'             `---'  |
|   ||   .---.   | |   |          |      |  .---. - - - - -   |
|   | - (  B  ) -      |       |  |    |  -(  B  )            |
|   |    `-+-'     |   |          |         `-#-||            |
+---|--------------|---+       |  |    |      |   - - - - - - - - +
    |      |       |           |  |           | |             |
    |                          |  +----|------|-|-------------+   |
    |      |     .-+-.                        | + - - - - +
    |    .-+-.  (  E  )        |       |      |                   |
    |   (  D  )  `---'                        |           |
    |    `-+-'     |         .-+-.     |    .-#-.       .-+-.     |
    |            .-+-.      (  D  )-PL-----(  E  )--PL-(  F  )
    |      |    (  F  )      `---'     |    `-#-'       `-+-'   .-+-.
  .-#-.          `-+-'                        |                (  G  )
 (  G  ) - +       |               - - +      |           |     `-+-'
  `---- - - - - - -               |           |
                                .---.       .-#-.       .-+-.     |
                               (  H  )-PL--(  I  )--PL-(  J  )
                                `---'       `-#-'       `---'   .-+-.
                                              |           |    (  K  )
       ISD C: Disjointness                    |                 `---'
  +---------------------------+             .-#-.         |       |
  |          ISD Core         |            (  L  ) - - - -
  |                           |             `---' - - - - - - - - +
  | .---.               .---. |
  |(  A  ) - - - - - - (  C  )|
  | `-*-'               `-#-' |
  |   | |     .---.     | |   |
  |   |  - - (  B  ) - -  |   |
  |   |       `---'       |   |
  +---|-------------------|---+
      |                   |
 .----*.                .-#---.
(   D   )              (   E   )
 `----*'                `-#---'
 |    |                   |   |
    #---------------------#
 |  | |                       |
    | *------------------*
 |  |                    |    |
 .--#--.                .*----.
(   F   #-------#      (   G   )
 `-----'        |       `*----|
 |          *------------*
            |   |             |
 |-----.    |   |       .-----.
(   H  *----*   #------#   I   )
 `---*-'                `-#---'
     |                    |
     |       .---.        |
     *------*  J  #-------#
             `---'
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-example-networks-to-illustr" class="selfRef">Example networks to illustrate path-segment selection based on different path properties.</a>
              </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="path-segment-prop">
<section id="section-2.3.2">
          <h4 id="name-propagation-of-selected-pcb">
<a href="#section-2.3.2" class="section-number selfRef">2.3.2. </a><a href="#name-propagation-of-selected-pcb" class="section-name selfRef">Propagation of Selected PCBs</a>
          </h4>
<p id="section-2.3.2-1">As mentioned above, once per <em>propagation period</em> (determined by each AS), an AS propagates selected PCBs to its neighboring ASes. This happens on the level of both intra-ISD beaconing and core beaconing. This section describes both processes in more detail.<a href="#section-2.3.2-1" class="pilcrow">¶</a></p>
<p id="section-2.3.2-2">To bootstrap the initial communication with a neighboring beacon service, ASes use so-called one-hop paths. This special kind of path handles beaconing between neighboring ASes for which no forwarding path may be available yet. In fact, it is the task of beaconing to discover such forwarding paths. The purpose of one-hop paths is thus to break this circular dependency. The One-Hop Path Type is described in more detail in <span>[<a href="#I-D.scion-dp" class="cite xref">I-D.scion-dp</a>]</span>.<a href="#section-2.3.2-2" class="pilcrow">¶</a></p>
<div id="reception-of-pcbs">
<section id="section-2.3.2.1">
            <h5 id="name-reception-of-pcbs">
<a href="#section-2.3.2.1" class="section-number selfRef">2.3.2.1. </a><a href="#name-reception-of-pcbs" class="section-name selfRef">Reception of PCBs</a>
            </h5>
<p id="section-2.3.2.1-1">The following first steps of the propagation procedure are the same for both intra-ISD and core beaconing:<a href="#section-2.3.2.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.3.2.1-2">
<li id="section-2.3.2.1-2.1">
                <p id="section-2.3.2.1-2.1.1">Upon receiving a PCB, the control service of an AS verifies the validity of the PCB (see <a href="#pcb-validity" class="auto internal xref">Section 2.2.3</a>). Invalid PCBs <span class="bcp14">MUST</span> be discarded.
The PCB contains the version numbers of the trust root configuration(s) (TRC) and certificate(s) that <span class="bcp14">MUST</span> be used to verify its signatures. This enables the control service to check whether it has the relevant TRC(s) and certificate(s); if not, they can be requested from the control service of the sending AS.<a href="#section-2.3.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-2.3.2.1-2.2">
                <p id="section-2.3.2.1-2.2.1">As core beaconing is based on propagating PCBs to all AS neighbors, it is necessary to avoid loops during path creation. The control service of core ASes <span class="bcp14">MUST</span> therefore check whether the PCB includes duplicate hop entries created by the core AS itself or by other ASes. If so, the PCB <span class="bcp14">MUST</span> be discarded in order to avoid loops. Additionally, core ASes could forbid, that is, not propagate, beacons containing path segments that traverse the same ISD more than once. <strong>Note:</strong> Where loops must always be avoided, it is a policy decision to forbid ISD double-crossing. It can be legitimate to cross the same ISD multiple times: For example, if the ISD spans a large geographical area, a path transiting another ISD may constitute a shortcut. However, it is up to each core AS to decide whether it wants to allow this.<a href="#section-2.3.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-2.3.2.1-2.3">
                <p id="section-2.3.2.1-2.3.1">If the PCB verification is successful, the control service decides whether to store the PCB as a candidate for propagation based on selection criteria and polices specific for each AS. For more information on the selection process, see <a href="#selection" class="auto internal xref">Section 2.3.1</a>.<a href="#section-2.3.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</section>
</div>
<div id="intra-prop">
<section id="section-2.3.2.2">
            <h5 id="name-propagation-of-pcbs-in-intr">
<a href="#section-2.3.2.2" class="section-number selfRef">2.3.2.2. </a><a href="#name-propagation-of-pcbs-in-intr" class="section-name selfRef">Propagation of PCBs in Intra-ISD Beaconing</a>
            </h5>
<p id="section-2.3.2.2-1">The propagation process in intra-ISD beaconing includes the following steps:<a href="#section-2.3.2.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.3.2.2-2">
<li id="section-2.3.2.2-2.1">
                <p id="section-2.3.2.2-2.1.1">From the candidate PCBs stored in the beacon store, the control service of an AS selects the best PCBs to propagate to its downstream neighboring ASes, based on a selection algorithm specific for this AS.<a href="#section-2.3.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-2.3.2.2-2.2">
                <p id="section-2.3.2.2-2.2.1">The control service adds a new AS entry to every selected PCB. This AS entry <span class="bcp14">MUST</span> at least include:<a href="#section-2.3.2.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.2.2-2.2.2.1">
                    <p id="section-2.3.2.2-2.2.2.1.1">The ingress interface to this AS, in the hop field component.<a href="#section-2.3.2.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-2.3.2.2-2.2.2.2">
                    <p id="section-2.3.2.2-2.2.2.2.1">The egress interface to the neighboring AS, also in the hop field component.<a href="#section-2.3.2.2-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-2.3.2.2-2.2.2.3">
                    <p id="section-2.3.2.2-2.2.2.3.1">The ISD_AS number of the next AS, in the signed body component of the AS entry.<a href="#section-2.3.2.2-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-2.3.2.2-2.2.2.4">
                    <p id="section-2.3.2.2-2.2.2.4.1">If the AS has peering links, the control service <span class="bcp14">MAY</span> add corresponding peer entry components to the signed body of the AS entry; one peer entry component for each peering link that the AS wants to advertise. The hop field component of each added peer entry <span class="bcp14">MUST</span> have a specified egress interface.<a href="#section-2.3.2.2-2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li id="section-2.3.2.2-2.3">
                <p id="section-2.3.2.2-2.3.1">The control service <span class="bcp14">MUST</span> now sign each selected, extended PCB and append the computed signature.<a href="#section-2.3.2.2-2.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-2.3.2.2-2.4">
                <p id="section-2.3.2.2-2.4.1">As a final step, the control service propagates each extended PCB to the correct neighboring ASes, by invoking the <code>SegmentCreationService.Beacon</code> remote procedure call (RPC) in the control services of the neighboring ASes (see also <a href="#prop-proto" class="auto internal xref">Section 2.3.2.4</a>).<a href="#section-2.3.2.2-2.4.1" class="pilcrow">¶</a></p>
</li>
            </ol>
<p id="section-2.3.2.2-3"><strong>Note:</strong><a href="#section-2.3.2.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.2.2-4.1">
                <p id="section-2.3.2.2-4.1.1">For more information on the signed body component of an AS entry, see <a href="#ase-sign" class="auto internal xref">Section 2.2.1.4.2</a>.<a href="#section-2.3.2.2-4.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3.2.2-4.2">
                <p id="section-2.3.2.2-4.2.1">For more information on a peer entry, see <a href="#peerentry" class="auto internal xref">Section 2.2.1.7</a>.<a href="#section-2.3.2.2-4.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3.2.2-4.3">
                <p id="section-2.3.2.2-4.3.1">For more information on the hop field component, see <a href="#hopfield" class="auto internal xref">Section 2.2.1.6</a>.<a href="#section-2.3.2.2-4.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3.2.2-4.4">
                <p id="section-2.3.2.2-4.4.1">For more information on signing an AS entry, see <a href="#sign" class="auto internal xref">Section 2.2.1.4.3</a>.<a href="#section-2.3.2.2-4.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="propagation-of-pcbs-in-core-beaconing">
<section id="section-2.3.2.3">
            <h5 id="name-propagation-of-pcbs-in-core">
<a href="#section-2.3.2.3" class="section-number selfRef">2.3.2.3. </a><a href="#name-propagation-of-pcbs-in-core" class="section-name selfRef">Propagation of PCBs in Core Beaconing</a>
            </h5>
<p id="section-2.3.2.3-1">The propagation process in core beaconing includes the following steps:<a href="#section-2.3.2.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.3.2.3-2">
<li id="section-2.3.2.3-2.1">
                <p id="section-2.3.2.3-2.1.1">The core control service selects the best PCBs to forward to neighboring core ASes observed so far.<a href="#section-2.3.2.3-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-2.3.2.3-2.2">
                <p id="section-2.3.2.3-2.2.1">The service adds a new AS entry to every selected PCB. This AS entry <span class="bcp14">MUST</span> at least include:<a href="#section-2.3.2.3-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.2.3-2.2.2.1">
                    <p id="section-2.3.2.3-2.2.2.1.1">The egress interface to the neighboring core AS, in the hop field component.<a href="#section-2.3.2.3-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-2.3.2.3-2.2.2.2">
                    <p id="section-2.3.2.3-2.2.2.2.1">The ISD_AS number of the neighboring core AS, in the signed body component of the AS entry.<a href="#section-2.3.2.3-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li id="section-2.3.2.3-2.3">
                <p id="section-2.3.2.3-2.3.1">The core control service <span class="bcp14">MUST</span> now sign the extended PCBs and append the computed signature.<a href="#section-2.3.2.3-2.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-2.3.2.3-2.4">
                <p id="section-2.3.2.3-2.4.1">As a final step, the service propagates the extended PCBs to the neighboring core ASes, by invoking the <code>SegmentCreationService.Beacon</code> remote procedure call (RPC) in the control services of the neighboring core ASes (see also <a href="#prop-proto" class="auto internal xref">Section 2.3.2.4</a>).<a href="#section-2.3.2.3-2.4.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</section>
</div>
<div id="prop-proto">
<section id="section-2.3.2.4">
            <h5 id="name-propagation-of-pcbs-in-prot">
<a href="#section-2.3.2.4" class="section-number selfRef">2.3.2.4. </a><a href="#name-propagation-of-pcbs-in-prot" class="section-name selfRef">Propagation of PCBs in Protobuf Message Format</a>
            </h5>
<p id="section-2.3.2.4-1">The last step of the above described core and intra-ISD propagation procedures is implemented as follows in Protobuf message format:<a href="#section-2.3.2.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.3.2.4-2">
<pre>
   service SegmentCreationService {
       rpc Beacon(BeaconRequest) returns (BeaconResponse) {}
   }

   message BeaconRequest {
       PathSegment segment = 1;
   }

   message BeaconResponse {}
</pre><a href="#section-2.3.2.4-2" class="pilcrow">¶</a>
</div>
<p id="section-2.3.2.4-3">The propagation procedure includes the following elements:<a href="#section-2.3.2.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.2.4-4.1">
                <p id="section-2.3.2.4-4.1.1"><code>SegmentCreationService</code>: Specifies the service via which the extended PCB is propagated to the control service of the neighboring AS.<a href="#section-2.3.2.4-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.2.4-4.1.2.1">
                    <p id="section-2.3.2.4-4.1.2.1.1"><code>Beacon</code>: Specifies the method that calls the control service at the neighboring AS in order to propagate the extended PCB.<a href="#section-2.3.2.4-4.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="section-2.3.2.4-4.2">
                <p id="section-2.3.2.4-4.2.1"><code>BeaconRequest</code>: Specifies the request message sent by the <code>Beacon</code> method to the control service of the neighboring AS. It contains the following element:<a href="#section-2.3.2.4-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.2.4-4.2.2.1">
                    <p id="section-2.3.2.4-4.2.2.1.1"><code>PathSegment</code>: Specifies the path segment to propagate to the neighboring AS. For more information on the Protobuf message type <code>PathSegment</code>, see <a href="#segment" class="auto internal xref">Section 2.2.1.1</a>.<a href="#section-2.3.2.4-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="section-2.3.2.4-4.3">
                <p id="section-2.3.2.4-4.3.1"><code>BeaconResponse</code>: Specifies the response message from the neighboring AS.<a href="#section-2.3.2.4-4.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
</section>
</div>
<div id="effects-of-clock-inaccuracy">
<section id="section-2.3.3">
          <h4 id="name-effects-of-clock-inaccuracy">
<a href="#section-2.3.3" class="section-number selfRef">2.3.3. </a><a href="#name-effects-of-clock-inaccuracy" class="section-name selfRef">Effects of Clock Inaccuracy</a>
          </h4>
<p id="section-2.3.3-1">A PCB originated by a given control service is validated by all the control services that receive it. All have different clocks. Their differences affect the validation process:<a href="#section-2.3.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.3-2.1">
              <p id="section-2.3.3-2.1.1">A fast clock at origination or a slow clock at reception will yield a lengthened expiration time for hops, and possibly an origination time in the future.<a href="#section-2.3.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.3.3-2.2">
              <p id="section-2.3.3-2.2.1">A slow clock at origination or a fast clock at reception will yield a shortened expiration time for hops, and possibly an expiration time in the past.<a href="#section-2.3.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.3.3-3">This bias comes in addition to a structural delay: PCBs are propagated at a configurable interval (typically, around one minute). As a result of this and the way they are iteratively constructed, PCBs with N hops may be validated up to N intervals (so maximally N minutes) after origination. This creates a constraint on the expiration of hops. Hops of the minimal expiration time (337.5 seconds - see <a href="#hopfield" class="auto internal xref">Section 2.2.1.6</a>) would render useless any PCB describing a path longer than 5 hops. For this reason, it is unadvisable to create hops with a short expiration time, that should be around 6 hours.<a href="#section-2.3.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3.3-4">The control service and its clients authenticate each-other according to their respective AS's certificate. Path segments are authenticated based on the certificates of the ASes that they refer to. The expiration of a SCION AS certificate typically ranges from 3h to 5 years.
In comparison to these time scales, clock offsets in the order of minutes are immaterial.<a href="#section-2.3.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3.3-5">Each administrator of a SCION control service is responsible for maintaining sufficient clock accuracy. No particular method is assumed by this specification.<a href="#section-2.3.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="scalability">
<section id="section-2.4">
        <h3 id="name-path-discovery-time-and-sca">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-path-discovery-time-and-sca" class="section-name selfRef">Path Discovery Time and Scalability</a>
        </h3>
<p id="section-2.4-1">The path discovery mechanism balances the number of discovered paths and the time it takes to discover them versus resource overhead of the discovery.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">The resource costs for path discovery are communication overhead, processing and storage. Communication is transmitting the PCBs and occasionally obtaining the required PKI material. Processing cost is validating the signatures of the AS entries, signing new AS entries, and, to a lesser extent, evaluating the beaconing policies. Storage is both the temporary storage of PCBs before the next propagation interval, and the storage of complete discovered path segments.
All of these depend on the the number and length of the discovered path segments, that is, on the total number of AS entries of the discovered path segments.<a href="#section-2.4-2" class="pilcrow">¶</a></p>
<p id="section-2.4-3">Interesting metrics for scalability and speed of path discovery are the time until all discoverable path segments have been discovered after a "cold start", and the time until new link is usable.
Generally, the time until a specific PCB is built depends on its length, the propagation interval, whether on-path ASes use "fast recovery".
At each AS, the PCB will be processed and propagated at the subsequent propagation event. As propagation events are not synchronized between different ASes, a PCB arrives at a random point in time during the interval and may be buffered before potentially being propagated.
With a propagation interval T at each AS, the mean time until the PCB is propagated in one AS therefore is T / 2 and the mean total time for the propagation steps of a PCB of length L is at worst L * T / 2 (with a variance of L * T^2 / 12).<a href="#section-2.4-3" class="pilcrow">¶</a></p>
<p id="section-2.4-4">Note that link removal is not part of path discovery in SCION. For scheduled removal of links, operators let path segments expire. On link failures, endpoints route around the failed link by switching to different paths in the data plane.<a href="#section-2.4-4" class="pilcrow">¶</a></p>
<p id="section-2.4-5">To achieve scalability in its routing process, SCION uses a divide-and-conquer approach, partitioning  ASes into ISDs. In order to benefit from this, an ideal topology SCION should keep the inter-ISD core network to a moderate size. For more specific observations, we distinguish between intra- and inter-ISD beaconing.<a href="#section-2.4-5" class="pilcrow">¶</a></p>
<div id="intra-isd-beaconing">
<section id="section-2.4.1">
          <h4 id="name-intra-isd-beaconing">
<a href="#section-2.4.1" class="section-number selfRef">2.4.1. </a><a href="#name-intra-isd-beaconing" class="section-name selfRef">Intra-ISD Beaconing</a>
          </h4>
<p id="section-2.4.1-1">In the intra-ISD beaconing, PCBs are propagated top-down, along parent-child links, from core to leaf ASes. Each AS discovers path segments from itself to the core ASes of its ISD.<a href="#section-2.4.1-1" class="pilcrow">¶</a></p>
<p id="section-2.4.1-2">Typically, this directed, acyclic graph is narrow at the top, widens towards the leafs, and is relatively shallow; intermediate provider ASes have a large number of children, while they only have a small number of parents. The chain of intermediate providers from a leaf AS to a core AS is typically not long (e.g. local, regional, national provider, then core).<a href="#section-2.4.1-2" class="pilcrow">¶</a></p>
<p id="section-2.4.1-3">Each AS potentially receives PCBs for all down-path segments from the core to itself. While the number of distinct provider chains to the core is typically moderate, the multiplicity of links between provider ASes has multiplicative effect on the number of PCBs. Once this number grows above the maximum recommended best PCBs set size of 50, ASes trim the set of PCBs propagated. As the choice is among different ways to transit the local AS, operators are well equipped to choose among this set of PCBs.
Ultimately, the number of PCBs received by an AS per propagation interval remains bounded by 50 for each parent link of an AS, and at most 50 PCBs per child link are propagated. The length of these PCBs, and thus the number of AS entries to be processed and stored, is expected to be moderate and not grow considerably with network size. The total resource overhead for beacon propagation is easily manageable even for highly connected ASes.<a href="#section-2.4.1-3" class="pilcrow">¶</a></p>
<p id="section-2.4.1-4">To illustrate this with some numbers, an AS with a rather large number of 100 parent links receives at most 5000 PCBs during a propagation interval. Assuming a generous average length of 10 AS entries for these PCBs, this corresponds to 50000 AS entries. Due to the variable length fields in AS entries, the sizes for storage and transmission cannot be predicted exactly, and we'll assume an average of 250 bytes per AS entry. At the shortest, and thus chattiest, recommended propagation interval of 5 seconds, this corresponds to an average bandwidth of around 2.5MB/s, and processing 10000 signature verifications per second.
If the same AS has 1000 child links, the propagation of the beacons will require signing one new AS entry for each of the propagated PCBs for each link (at most 50 per link), that is at most 50000 signatures per propagation event.
The total bandwidth for the propagation of these PCBs for all 1000 child links would, again very roughly, be around 25MB/s.
All of these are manageable with even modest consumer hardware.<a href="#section-2.4.1-4" class="pilcrow">¶</a></p>
<p id="section-2.4.1-5">On a cold start of the network, path segments to each AS are discovered within a number of propagation steps proportional to the longest path. With a 5 second propagation period and a generous longest path of length 10, all path segments are discovered after 25 seconds on average.
When all ASes start propagation interval just after they've received the first PCBs from any of their upstreams (see 'fast recovery'), the construction of a first path to connect each AS to the ISD core is accelerated.<a href="#section-2.4.1-5" class="pilcrow">¶</a></p>
<p id="section-2.4.1-6">When a new parent-child link is added to the network, the parent AS will propagate the available PCBs in the next propagation event. If the AS on the child side of the new link is a leaf AS, path discovery is thus complete after at most one propagation interval. Otherwise, child ASes at distance D below the new link, learn of the new link after at worst D further propagation intervals.<a href="#section-2.4.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="inter-isd-beaconing">
<section id="section-2.4.2">
          <h4 id="name-inter-isd-beaconing">
<a href="#section-2.4.2" class="section-number selfRef">2.4.2. </a><a href="#name-inter-isd-beaconing" class="section-name selfRef">Inter-ISD Beaconing</a>
          </h4>
<p id="section-2.4.2-1">In the inter-ISD core beaconing, PCBs are propagated omnidirectionally along core links. Each AS discovers path segments from itself to any other core AS.
The number of distinct paths through the core network is typically very large. To keep the overhead manageable, at most 5 path segments to every destination AS are discovered, and the propagation frequency is slower than in the intra-ISD beaconing (at least 60 seconds between propagation events).<a href="#section-2.4.2-1" class="pilcrow">¶</a></p>
<p id="section-2.4.2-2">Without making strong assumptions on the topology of the core network, we can assume that shortest paths through real world, internet-like networks are relatively short; for example, the Barabási-Albert random graph model predicts a diameter of log(N)/log(log(N)) for a network with N nodes <span>[<a href="#BollRio-2000" class="cite xref">BollRio-2000</a>]</span>. The average distance scales in the same way.
We cannot assume that the selected PCBs are strictly shortest paths through the network, but it's reasonable to assume that they will not be very much longer than the shortest paths either.<a href="#section-2.4.2-2" class="pilcrow">¶</a></p>
<p id="section-2.4.2-3">With N the number of participating core ASes, an AS receives up to 5 * N PCBs per propagation interval per core link interface.
For highly connected ASes, the number of PCBs received thus becomes rather large. In a network of 1000 ASes, a highly connected AS with 300 core links receives up to 1.5 million PCBs per propagation interval.
Assuming an average PCB length of 6 and the shortest propagation interval of 60 seconds, this corresponds to roughly 150 thousand signature validations per second. In terms of bandwidth, this corresponds to very roughly 38MB/s.
All of these are manageable on a present day small server or desktop machine.
For much larger, more highly connected ASes, the path-discovery tasks of the control service can be distributed over many instances in order to increase the PCB throughput.<a href="#section-2.4.2-3" class="pilcrow">¶</a></p>
<p id="section-2.4.2-4">On a cold start of the network, full connectivity is obtained after a number of propagation steps corresponding to the diameter of the network. Assuming a network diameter of 6, this corresponds to roughly 3 minutes on average.<a href="#section-2.4.2-4" class="pilcrow">¶</a></p>
<p id="section-2.4.2-5">When a new link is added to the network, it will be available to connect two ASes at distances D1 and D2 from the link, respectively, at worst after a mean time (D1+D2)*T/2.<a href="#section-2.4.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="path-segment-reg">
<section id="section-3">
      <h2 id="name-registration-of-path-segmen">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-registration-of-path-segmen" class="section-name selfRef">Registration of Path Segments</a>
      </h2>
<p id="section-3-1"><strong>Path registration</strong> is the process where an AS transforms selected PCBs into path segments, and adds these segments to the relevant path databases, thus making them available to other ASes.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">As mentioned previously, a non-core AS typically receives several PCBs representing several path segments to the core ASes of the ISD the AS belongs to. Out of these PCBs, the non-core AS selects those down-path segments through which it wants to be reached, based on AS-specific selection criteria. The next step is to register the selected down-segments with the control service of the relevant core ASes, according to a process called <em>intra-ISD path-segment registration</em>. As a result, a core AS's control service contains all intra-ISD path segments registered by the non-core ASes of its ISD. In addition, each core AS control service also stores preferred core-path segments to other core ASes, in the <em>core-segment registration</em> process. Both processes are described below.<a href="#section-3-2" class="pilcrow">¶</a></p>
<div id="intra-reg">
<section id="section-3.1">
        <h3 id="name-intra-isd-path-segment-regi">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-intra-isd-path-segment-regi" class="section-name selfRef">Intra-ISD Path-Segment Registration</a>
        </h3>
<p id="section-3.1-1">Every <em>registration period</em> (determined by each AS), the AS's control service selects two sets of PCBs to transform into two types of path segments:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-2.1">
            <p id="section-3.1-2.1.1">Up-segments, which allow the infrastructure entities and endpoints in this AS to communicate with core ASes; and<a href="#section-3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.2">
            <p id="section-3.1-2.2.1">down-segments, which allow remote entities to reach this AS.<a href="#section-3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-3">The up- and down-segments do not have to be equal. An AS may want to communicate with core ASes via one or more up-segments that differ from the down-segment(s) through which it wants to be reached. Therefore, an AS can define different selection policies for the up- and down-segment sets. Also, the processes of transforming a PCB in an up-segment or a down-segment differ slightly. Both processes are described below.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<div id="term-pcb">
<section id="section-3.1.1">
          <h4 id="name-terminating-a-pcb">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-terminating-a-pcb" class="section-name selfRef">Terminating a PCB</a>
          </h4>
<p id="section-3.1.1-1">Both the up- and down-segments end at the AS. One could therefore say that by transforming a PCB into a path segment, an AS "terminates" the PCB for this AS ingress interface and at this moment in time.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2">The control service of a non-core AS <span class="bcp14">MUST</span> perform the following steps to "terminate" a PCB:<a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.1.1-3">
<li id="section-3.1.1-3.1">
              <p id="section-3.1.1-3.1.1">The control service adds a new AS entry to the PCB. This new AS entry <span class="bcp14">MUST</span> be defined as follows:<a href="#section-3.1.1-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1.1-3.1.2.1">
                  <p id="section-3.1.1-3.1.2.1.1">The next AS <span class="bcp14">MUST NOT</span> be specified.<a href="#section-3.1.1-3.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1.1-3.1.2.1.2.1">
                      <p id="section-3.1.1-3.1.2.1.2.1.1">In Protobuf message format, this means that the value of the <code>next_isd_as</code> field in the <code>ASEntrySignedBody</code> component <span class="bcp14">MUST</span> be "0".<a href="#section-3.1.1-3.1.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
                <li class="normal" id="section-3.1.1-3.1.2.2">
                  <p id="section-3.1.1-3.1.2.2.1">The egress interface in the hop field component <span class="bcp14">MUST NOT</span> be specified.<a href="#section-3.1.1-3.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1.1-3.1.2.2.2.1">
                      <p id="section-3.1.1-3.1.2.2.2.1.1">In Protobuf message format, this means that the value of the <code>egress</code> field in the <code>HopField</code> component <span class="bcp14">MUST</span> be "0".<a href="#section-3.1.1-3.1.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
            <li id="section-3.1.1-3.2">
              <p id="section-3.1.1-3.2.1">If the AS has peering links, the control service <span class="bcp14">MAY</span> add corresponding peer entry components to the signed body of the AS entry - one peer entry component for each peering link that the AS wants to advertise. The egress interface ID in the hop field component of each added peer entry <span class="bcp14">MUST NOT</span> be specified.<a href="#section-3.1.1-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1.1-3.2.2.1">
                  <p id="section-3.1.1-3.2.2.1.1">In Protobuf message format, this means that the value of the <code>egress</code> field in the <code>HopField</code> component <span class="bcp14">MUST</span> be "0".<a href="#section-3.1.1-3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="section-3.1.1-3.3">
              <p id="section-3.1.1-3.3.1">As a last step, the control service <span class="bcp14">MUST</span> sign the modified PCB and append the computed signature.<a href="#section-3.1.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-3.1.1-4"><strong>Note:</strong><a href="#section-3.1.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1.1-5.1">
              <p id="section-3.1.1-5.1.1">For more information on the signed body component of an AS entry, see <a href="#ase-sign" class="auto internal xref">Section 2.2.1.4.2</a>.<a href="#section-3.1.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.1.1-5.2">
              <p id="section-3.1.1-5.2.1">For more information on a peer entry, see <a href="#peerentry" class="auto internal xref">Section 2.2.1.7</a>.<a href="#section-3.1.1-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.1.1-5.3">
              <p id="section-3.1.1-5.3.1">For more information on the hop field component, see <a href="#hopfield" class="auto internal xref">Section 2.2.1.6</a>.<a href="#section-3.1.1-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.1.1-5.4">
              <p id="section-3.1.1-5.4.1">For more information on signing an AS entry, see <a href="#sign" class="auto internal xref">Section 2.2.1.4.3</a>.<a href="#section-3.1.1-5.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="transforming-a-pcb-into-an-up-segment">
<section id="section-3.1.2">
          <h4 id="name-transforming-a-pcb-into-an-">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-transforming-a-pcb-into-an-" class="section-name selfRef">Transforming a PCB into an Up-Segment</a>
          </h4>
<p id="section-3.1.2-1">Every registration period, the control service of a non-core AS performs the following steps to transform PCBs into up-segments:<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.1.2-2">
<li id="section-3.1.2-2.1">
              <p id="section-3.1.2-2.1.1">The control service selects the PCBs that it wants to transform into up-segments from the candidate PCBs in the beacon store.<a href="#section-3.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.1.2-2.2">
              <p id="section-3.1.2-2.2.1">The control service "terminates" the selected PCBs by performing the steps described in <a href="#term-pcb" class="auto internal xref">Section 3.1.1</a>. From this moment on, the modified PCBs are called <strong>up-segments</strong>.<a href="#section-3.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.1.2-2.3">
              <p id="section-3.1.2-2.3.1">The control service now adds the newly created up-segments to its own path database.<a href="#section-3.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-3.1.2-3"><strong>Note:</strong> For more information on possible selection strategies of PCBs, see <a href="#selection" class="auto internal xref">Section 2.3.1</a>.<a href="#section-3.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="transforming-a-pcb-into-a-down-segment">
<section id="section-3.1.3">
          <h4 id="name-transforming-a-pcb-into-a-d">
<a href="#section-3.1.3" class="section-number selfRef">3.1.3. </a><a href="#name-transforming-a-pcb-into-a-d" class="section-name selfRef">Transforming a PCB into a Down-Segment</a>
          </h4>
<p id="section-3.1.3-1">Every registration period, the control service of a non-core AS performs the following steps to transform PCBs into down-segments:<a href="#section-3.1.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.1.3-2">
<li id="section-3.1.3-2.1">
              <p id="section-3.1.3-2.1.1">The control service selects the PCBs that it wants to transform into down-segments from the candidate PCBs in the beacon store.<a href="#section-3.1.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.1.3-2.2">
              <p id="section-3.1.3-2.2.1">The control service "terminates" the selected PCBs by performing the steps described in <a href="#term-pcb" class="auto internal xref">Section 3.1.1</a>. From this moment on, the modified PCBs are called <strong>down-segments</strong>.<a href="#section-3.1.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.1.3-2.3">
              <p id="section-3.1.3-2.3.1">The control service now registers the newly created down-segments with the control services of the core ASes that originated the corresponding PCBs. This is done by invoking the <code>SegmentRegistrationService.SegmentsRegistration</code> remote procedure call (RPC) in the control services of the relevant core ASes (see also <a href="#reg-proto" class="auto internal xref">Section 3.3</a>).<a href="#section-3.1.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-3.1.3-3"><strong>Note:</strong> For more information on possible selection strategies of PCBs, see <a href="#selection" class="auto internal xref">Section 2.3.1</a>.<a href="#section-3.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="core-path-segment-registration">
<section id="section-3.2">
        <h3 id="name-core-path-segment-registrat">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-core-path-segment-registrat" class="section-name selfRef">Core Path-Segment Registration</a>
        </h3>
<p id="section-3.2-1">The core beaconing process creates path segments from core AS to core AS. These core-segments are then added to the control service path database of the core AS that created the segment, so that local and remote endpoints can obtain and use these core-segments. In contrast to the intra-ISD registration procedure, there is no need to register core-segments with other core ASes (as each core AS will receive PCBs originated from every other core AS).<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">In every registration period, the control service of a core AS performs the following operations:<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.2-3">
<li id="section-3.2-3.1">
            <p id="section-3.2-3.1.1">The core control service selects the best PCBs towards each core AS observed so far.<a href="#section-3.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.2-3.2">
            <p id="section-3.2-3.2.1">The core control service "terminates" the selected PCBs by performing the steps described in <a href="#term-pcb" class="auto internal xref">Section 3.1.1</a>. From this moment on, the modified PCBs are called <strong>core-segments</strong>.<a href="#section-3.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.2-3.3">
            <p id="section-3.2-3.3.1">As a final step, the control service adds the newly created core-segments to its own path database.<a href="#section-3.2-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-3.2-4"><strong>Note:</strong> For more information on possible selection strategies of PCBs, see <a href="#selection" class="auto internal xref">Section 2.3.1</a>.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="reg-proto">
<section id="section-3.3">
        <h3 id="name-path-segment-registration-o">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-path-segment-registration-o" class="section-name selfRef">Path-Segment Registration on Code-Level</a>
        </h3>
<p id="section-3.3-1">The control service of a non-core AS has to register the newly created down-segments with the control services of the core ASes that originated the corresponding PCBs. This registration step is implemented as follows in Protobuf message format:<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.3-2">
<pre>
   enum SegmentType {
       SEGMENT_TYPE_UNSPECIFIED = 0;
       SEGMENT_TYPE_UP = 1;
       SEGMENT_TYPE_DOWN = 2;
       SEGMENT_TYPE_CORE = 3;
   }

   service SegmentRegistrationService {
       rpc SegmentsRegistration(SegmentsRegistrationRequest) returns (
         SegmentsRegistrationResponse) {}
   }

   message SegmentsRegistrationRequest {
       message Segments {
           repeated PathSegment segments = 1;
       }

       map&lt;int32, Segments&gt; segments = 1;
   }

   message SegmentsRegistrationResponse {}
</pre><a href="#section-3.3-2" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-3.3-3.1">
            <p id="section-3.3-3.1.1"><code>SegmentType</code>: Specifies the type of the path segment to be registered. Currently, only the following type is used:<a href="#section-3.3-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-3.1.2.1">
                <p id="section-3.3-3.1.2.1.1"><code>SEGMENT_TYPE_DOWN</code>: Specifies a down-segment.<a href="#section-3.3-3.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-3.3-3.2">
            <p id="section-3.3-3.2.1"><code>map&lt;int32, Segments&gt; segments</code>: Represents a separate list of segments for each path segment type. The key is the integer representation of the corresponding <code>SegmentType</code>.<a href="#section-3.3-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="lookup">
<section id="section-4">
      <h2 id="name-path-lookup">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-path-lookup" class="section-name selfRef">Path Lookup</a>
      </h2>
<p id="section-4-1">The <em>path lookup</em> is a fundamental building block of SCION's path management, as it enables endpoints to obtain path segments found during path exploration and registered during path registration. This allows the endpoints to construct end-to-end paths from the set of possible path segments returned by the path lookup process. The lookup of paths still happens in the control plane, whereas the construction of the actual end-to-end paths happens in the data plane.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="lookup-process">
<section id="section-4.1">
        <h3 id="name-lookup-process">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-lookup-process" class="section-name selfRef">Lookup Process</a>
        </h3>
<p id="section-4.1-1">An endpoint (source) that wants to start communication with another endpoint (destination), requires up to three path segments:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">
            <p id="section-4.1-2.1.1">An up-path segment to reach the core of the source ISD (only if the source endpoint is a non-core AS),<a href="#section-4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.2">
            <p id="section-4.1-2.2.1">a core-path segment to reach<a href="#section-4.1-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.2.2.1">
                <p id="section-4.1-2.2.2.1.1">another core AS in the source ISD, in case the destination AS is in the same source ISD, or<a href="#section-4.1-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1-2.2.2.2">
                <p id="section-4.1-2.2.2.2.1">a core AS in a remote ISD, if the destination AS is in another ISD, and<a href="#section-4.1-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.1-2.3">
            <p id="section-4.1-2.3.1">a down-path segment to reach the destination AS.<a href="#section-4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-3">The actual number of required path segments depends on the location of the destination AS as well as on the availability of shortcuts and peering links. More information on combining and constructing paths is provided by <span>[<a href="#I-D.scion-dp" class="cite xref">I-D.scion-dp</a>]</span>.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">The process to look up and fetch path segments consists of the following steps:<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.1-5">
<li id="section-4.1-5.1">
            <p id="section-4.1-5.1.1">First, the source endpoint queries the control service in its own AS (i.e., the source AS) for the required segments. The control service has up-path segments stored in its path database. Additionally, the control service checks if it has appropriate core- and down-path segments in store as well; in this case it returns them immediately.<a href="#section-4.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-5.2">
            <p id="section-4.1-5.2.1">If there are no appropriate core-segments and down-segments, the control service in the source AS queries the control services of the reachable core ASes in the source ISD, for core-path segments to core ASes in the destination ISD (which is either the own or a remote ISD). To reach the core control services, the control service of the source AS uses the locally stored up-path segments.<a href="#section-4.1-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-5.3">
            <p id="section-4.1-5.3.1">Next, the control service of the source AS combines up-path segments with the newly retrieved core-path segments. The control service then queries the control services of the remote core ASes in the destination ISD, to fetch down-path segments to the destination AS. To reach the remote core ASes, the control service of the source AS uses the previously obtained and combined up- and core segments.<a href="#section-4.1-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-5.4">
            <p id="section-4.1-5.4.1">Finally, the control service of the source AS returns all retrieved path segments to the source endpoint.<a href="#section-4.1-5.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-5.5">
            <p id="section-4.1-5.5.1">Once it has obtained all path segments, the source endpoint combines them into an end-to-end path in the data plane.<a href="#section-4.1-5.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-5.6">
            <p id="section-4.1-5.6.1">The destination endpoint, once it receives the first packet, <span class="bcp14">MAY</span> revert the path in the received packet in order to construct a response. This ensures that traffic flows on the same path bidirectionally.<a href="#section-4.1-5.6.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.1-6"><a href="#_table-3" class="auto internal xref">Table 3</a> below shows which control service provides the source endpoint with which type of path segment.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<span id="name-control-services-responsibl"></span><div id="_table-3">
<table class="center" id="table-3">
          <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-control-services-responsibl" class="selfRef">Control services responsible for different types of path segments</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Segment Type</th>
              <th class="text-left" rowspan="1" colspan="1">Responsible control service(s)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Up-segment</td>
              <td class="text-left" rowspan="1" colspan="1">Control service of the source AS</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Core-segment</td>
              <td class="text-left" rowspan="1" colspan="1">Control service of core ASes in source ISD</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Down-segment</td>
              <td class="text-left" rowspan="1" colspan="1">Control service of core ASes in destination ISD (either the local ISD or a remote ISD)</td>
            </tr>
          </tbody>
        </table>
</div>
<div id="sequence-of-lookup-requests">
<section id="section-4.1.1">
          <h4 id="name-sequence-of-lookup-requests">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-sequence-of-lookup-requests" class="section-name selfRef">Sequence of Lookup Requests</a>
          </h4>
<p id="section-4.1.1-1">The overall sequence of requests to resolve a path <span class="bcp14">SHOULD</span> be as follows:<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.1.1-2">
<li id="section-4.1.1-2.1">
              <p id="section-4.1.1-2.1.1">Request up-segments for the source endpoint at the control service of the source AS.<a href="#section-4.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.1.1-2.2">
              <p id="section-4.1.1-2.2.1">Request core-segments, which start at the core ASes that are reachable with up-segments, and end at the core ASes in the destination ISD. If the destination ISD coincides with the source ISD, this step requests core segments to core ASes that the source endpoint cannot directly reach with an up-segment.<a href="#section-4.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.1.1-2.3">
              <p id="section-4.1.1-2.3.1">Request down-segments starting at core ASes in the destination ISD.<a href="#section-4.1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="caching">
<section id="section-4.1.2">
          <h4 id="name-caching">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-caching" class="section-name selfRef">Caching</a>
          </h4>
<p id="section-4.1.2-1">For the sake of efficiency, the control service of the source AS <span class="bcp14">SHOULD</span> cache each returned path segment request. Caching ensures that path lookups are fast for frequently used destinations. The use of caching is also essential to ensure that the path-lookup process is scalable and can be performed with low latency.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">In general, to improve overall efficiency, the control services of all ASes <span class="bcp14">SHOULD</span> do the following:<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2-3.1">
              <p id="section-4.1.2-3.1.1">Cache the returned path segments.<a href="#section-4.1.2-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-3.2">
              <p id="section-4.1.2-3.2.1">Send requests in parallel when requesting path segments from other control services.<a href="#section-4.1.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="behavior-of-actors-in-the-lookup-process">
<section id="section-4.2">
        <h3 id="name-behavior-of-actors-in-the-l">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-behavior-of-actors-in-the-l" class="section-name selfRef">Behavior of Actors in the Lookup Process</a>
        </h3>
<p id="section-4.2-1">As described above, the source endpoint resolves paths with a sequence of segment requests to the control service of the source AS. The control service in the source AS answers directly, or forwards these requests to the responsible control services of core ASes. In SCION, the instances that handle these segment requests at the control services are called <em>source AS segment-request handler</em> and <em>core AS segment-request handler</em>, respectively. This section specifies the behavior of the segment-request handlers in the lookup process. First, the use of wildcards in the lookup process is briefly addressed.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div id="wildcard">
<section id="section-4.2.1">
          <h4 id="name-use-of-wildcard-addresses-i">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-use-of-wildcard-addresses-i" class="section-name selfRef">Use of Wildcard Addresses in the Lookup Process</a>
          </h4>
<p id="section-4.2.1-1">Endpoints can use wildcard addresses to designate any core AS in path-segment requests. The segment-request handlers <span class="bcp14">MUST</span> expand these wildcard addresses and translate them into one or more actual addresses. <a href="#_table-4" class="auto internal xref">Table 4</a> below shows who is responsible for what.<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.2.1-2"><strong>Note:</strong> For general information on the use of wildcard addresses in SCION, see <a href="#serv-disc" class="auto internal xref">Section 1.5.3</a>.<a href="#section-4.2.1-2" class="pilcrow">¶</a></p>
<span id="name-use-of-wildcards-in-path-se"></span><div id="_table-4">
<table class="center" id="table-4">
            <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-use-of-wildcards-in-path-se" class="selfRef">Use of wildcards in path segments requests</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Segment Request</th>
                <th class="text-left" rowspan="1" colspan="1">Wildcard Represents</th>
                <th class="text-left" rowspan="1" colspan="1">Expanded/Translated By</th>
                <th class="text-left" rowspan="1" colspan="1">Translated Into</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Up-segment</td>
                <td class="text-left" rowspan="1" colspan="1">"Destination" core AS (where up-segment ends)</td>
                <td class="text-left" rowspan="1" colspan="1">Control service of the <em>source AS</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Actual address destination core AS in source ISD</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Core-segment</td>
                <td class="text-left" rowspan="1" colspan="1">Source core AS (where core-segment starts)<sup>1</sup>
</td>
                <td class="text-left" rowspan="1" colspan="1">Control service of the <em>source AS</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Actual address source core AS in source ISD</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Core-segment</td>
                <td class="text-left" rowspan="1" colspan="1">Destination core AS (where core-segment ends)</td>
                <td class="text-left" rowspan="1" colspan="1">Control service of the <em>source core AS</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Actual address destination core AS in destination ISD</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Down-segment</td>
                <td class="text-left" rowspan="1" colspan="1">"Source" core AS (where down-segment starts)<sup>2</sup>
</td>
                <td class="text-left" rowspan="1" colspan="1">Control service of the <em>source AS</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Actual address source core AS in destination ISD</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-4.2.1-4">1) Includes all core ASes for which an up-segment from the source AS exists.<br>
2) Includes all core ASes in destination ISD with a down-segment to destination AS.<a href="#section-4.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="segment-request-handler-of-a-non-core-source-as">
<section id="section-4.2.2">
          <h4 id="name-segment-request-handler-of-">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-segment-request-handler-of-" class="section-name selfRef">Segment-Request Handler of a Non-Core Source AS</a>
          </h4>
<p id="section-4.2.2-1">When the segment-request handler of the control service of a <em>non-core</em> source AS receives a path segment request, it <span class="bcp14">MUST</span> proceed as follows:<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2.2-2">
<li id="section-4.2.2-2.1">
              <p id="section-4.2.2-2.1.1">Determine the requested segment type.<a href="#section-4.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.2.2-2.2">
              <p id="section-4.2.2-2.2.1">In the case of an up-segment request, look up matching up-segments in the path database and return them.<a href="#section-4.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.2.2-2.3">
              <p id="section-4.2.2-2.3.1">In the case of a core-segment request from a source core AS to a destination core AS:<a href="#section-4.2.2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2-2.3.2.1">
                  <p id="section-4.2.2-2.3.2.1.1">Expand the source wildcard into separate requests for each reachable core AS in the source ISD.<a href="#section-4.2.2-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.2.2-2.3.2.2">
                  <p id="section-4.2.2-2.3.2.2.1">For each core-segment request,<a href="#section-4.2.2-2.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2-2.3.2.2.2.1">
                      <p id="section-4.2.2-2.3.2.2.2.1.1">If possible, return matching core-segments from cache;<a href="#section-4.2.2-2.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-4.2.2-2.3.2.2.2.2">
                      <p id="section-4.2.2-2.3.2.2.2.2.1">otherwise, request the core-segments from the control services of each reachable core AS at the source (start) of the core-segment. Add the retrieved core-segments to the cache.<a href="#section-4.2.2-2.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
            <li id="section-4.2.2-2.4">
              <p id="section-4.2.2-2.4.1">In the case of a down-segment request:<a href="#section-4.2.2-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2-2.4.2.1">
                  <p id="section-4.2.2-2.4.2.1.1">Expand the source wildcard into separate requests for every core AS in the destination ISD (destination ISD refers to the ISD to which the destination endpoint belongs).<a href="#section-4.2.2-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.2.2-2.4.2.2">
                  <p id="section-4.2.2-2.4.2.2.1">For each segment request,<a href="#section-4.2.2-2.4.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2-2.4.2.2.2.1">
                      <p id="section-4.2.2-2.4.2.2.2.1.1">If possible, return matching down-segments from cache;<a href="#section-4.2.2-2.4.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-4.2.2-2.4.2.2.2.2">
                      <p id="section-4.2.2-2.4.2.2.2.2.1">otherwise, request the down-segment from the control services of the core ASes at the source (start) of the down-segment. Sending the request may require looking up core-segments to the source core AS of the down-segment. Add the retrieved down-segments to the cache.<a href="#section-4.2.2-2.4.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
          </ol>
</section>
</div>
<div id="segment-request-handler-of-a-core-as">
<section id="section-4.2.3">
          <h4 id="name-segment-request-handler-of-a">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-segment-request-handler-of-a" class="section-name selfRef">Segment-Request Handler of a Core AS</a>
          </h4>
<p id="section-4.2.3-1">When the segment-request handler of a <em>core AS</em> control service receives a path segment request, it <span class="bcp14">MUST</span> proceed as follows:<a href="#section-4.2.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2.3-2">
<li id="section-4.2.3-2.1">
              <p id="section-4.2.3-2.1.1">Validate the request:<a href="#section-4.2.3-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.3-2.1.2.1">
                  <p id="section-4.2.3-2.1.2.1.1">The source of the path segment <span class="bcp14">MUST</span> be this core AS.<a href="#section-4.2.3-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.2.3-2.1.2.2">
                  <p id="section-4.2.3-2.1.2.2.1">The request <span class="bcp14">MUST</span> either be<a href="#section-4.2.3-2.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.3-2.1.2.2.2.1">
                      <p id="section-4.2.3-2.1.2.2.2.1.1">for a core-segment to a core AS in this ISD or another ISD, or<a href="#section-4.2.3-2.1.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-4.2.3-2.1.2.2.2.2">
                      <p id="section-4.2.3-2.1.2.2.2.2.1">for a down-segment to an AS in this ISD.<a href="#section-4.2.3-2.1.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
            <li id="section-4.2.3-2.2">
              <p id="section-4.2.3-2.2.1">If the destination is a core or wildcard address, then load matching core-segments from the path database and return.<a href="#section-4.2.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.2.3-2.3">
              <p id="section-4.2.3-2.3.1">Otherwise, load the matching down-segments from the path database and return.<a href="#section-4.2.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-4.2.3-3"><a href="#app-c" class="auto internal xref">Appendix "Path-Lookup Examples"</a> shows by means of an illustration how the lookup of path segments in SCION works.<a href="#section-4.2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">As described previously, the goal of SCION’s beaconing process in the control plane is to securely discover and disseminate paths between any two ASes. This section describes security considerations for SCION's control plane, that focuses on <em>inter</em>-domain routing. SCION does not provide intra-domain routing, nor does it provide end-to-end payload encryption. These topics lie therefore outside the scope of this section.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">This section focuses on three kinds of security risks in the control plane. The first risk is when an adversary controls one or all core ASes of an ISD and tries to manipulate the beaconing process from the top down (see <a href="#topdown-manipulate" class="auto internal xref">Section 5.1</a>). Also "ordinary" (non-core) adversaries that try to manipulate the beaconing process pose a risk to the control plane (see <a href="#manipulate-beaconing" class="auto internal xref">Section 5.2</a>). The third kind of security risks are Denial of Services (DoS) attacks, where attackers overload different parts of the infrastructure (see <a href="#dos-cp" class="auto internal xref">Section 5.3</a>).<a href="#section-5-2" class="pilcrow">¶</a></p>
<div id="topdown-manipulate">
<section id="section-5.1">
        <h3 id="name-manipulation-of-the-beaconi">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-manipulation-of-the-beaconi" class="section-name selfRef">Manipulation of the Beaconing Process by a Core Adversary</a>
        </h3>
<p id="section-5.1-1">The first kind of risk to the beaconing process comes from an adversary controlling one or more core ASes in an ISD. If the adversary stops all core AS(es) within an ISD from propagating PCBs, the discovery of new paths halts. In this case, downstream ASes will notice that PCBs are no longer being propagated, but all previously discovered (and still valid) paths remain usable for data-plane forwarding until they expire. This is an unlikely scenario, as it would require compromise of all core ASes within an ISD.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="manipulate-beaconing">
<section id="section-5.2">
        <h3 id="name-manipulation-of-the-beaconin">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-manipulation-of-the-beaconin" class="section-name selfRef">Manipulation of the Beaconing Process by a Non-Core Adversary</a>
        </h3>
<p id="section-5.2-1">This section examines several possible approaches open to an "ordinary" non-core adversary to manipulate the beaconing process in the SCION control plane, and shows for each case to what extent SCION's design can prevent the corresponding attack or help to mitigate it.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.1">
            <p id="section-5.2-2.1.1">Path hijacking through interposition (see <a href="#path-hijack" class="auto internal xref">Section 5.2.1</a>)<a href="#section-5.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-2.2">
            <p id="section-5.2-2.2.1">Creation of spurious ASes and ISDs (see <a href="#fake-ases" class="auto internal xref">Section 5.2.2</a>)<a href="#section-5.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-2.3">
            <p id="section-5.2-2.3.1">Peering link misuse (see <a href="#peer-link-misuse" class="auto internal xref">Section 5.2.3</a>)<a href="#section-5.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-2.4">
            <p id="section-5.2-2.4.1">Manipulation of the path selection process (see <a href="#manipulate-selection" class="auto internal xref">Section 5.2.4</a>)<a href="#section-5.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div id="path-hijack">
<section id="section-5.2.1">
          <h4 id="name-path-hijacking-through-inte">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-path-hijacking-through-inte" class="section-name selfRef">Path Hijacking through Interposition</a>
          </h4>
<p id="section-5.2.1-1">An malicious AS M might try to manipulate the beaconing process between two neighbor ASes A and B, with the goal to hijack traffic to flow via M. If M can interpose itself on the path between A and B, then it could attempt several potential attacks:<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.1-2.1">
              <p id="section-5.2.1-2.1.1">The adversary M could intercept and disseminate a PCB on its way from A to the neighboring AS B, and inject its own AS entry into the PCB toward downstream ASes.<a href="#section-5.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.1-2.2">
              <p id="section-5.2.1-2.2.1">The adversary could modify the hop fields of an already existing path, in order to insert its own AS in the path.<a href="#section-5.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.1-2.3">
              <p id="section-5.2.1-2.3.1">The adversary could fully block traffic between AS A and AS B, in order to force traffic redirection through an alternate path that includes its own AS.<a href="#section-5.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.2.1-3">The first type of attack is detectable and blocked by downstream ASes (e.g. B), because a PCB disseminated by AS A towards AS B contains the "Next ISD AS" field in the entry of AS A, pointing to AS B, and protected by A's signature. If M manipulates the PCB while in flight from A to B, then verification of the manipulated inbound PCBs will fail at AS B, as the adversary's PCBs cannot contain A's correct signature.
The second type of attack is made impossible by the hop field's MAC, which protects the hop field's integrity and chains it with the previous hop fields on the path.
The third type of attack generally cannot be prevented, however the alternate path would be immediately visible to endpoints, as traffic <span class="bcp14">MUST</span> include hop fields from AS M.<a href="#section-5.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="fake-ases">
<section id="section-5.2.2">
          <h4 id="name-creation-of-spurious-ases-a">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-creation-of-spurious-ases-a" class="section-name selfRef">Creation of Spurious ASes and ISDs</a>
          </h4>
<p id="section-5.2.2-1">An alternative scenario is when an adversary tries to introduce and spoof a nonexistent ASes. This would enable the adversary to send traffic with the spoofed AS as a source, allowing the adversary to complicate the detection of its attack and to plausibly deny the misbehavior.<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2.2-2">However, spoofing a new AS requires a registration of that AS with the ISD core to obtain a valid AS certificate; otherwise the adversary cannot construct valid PCBs. As this registration includes a thorough check and authentication by a CA, this cannot be done stealthily, which defeats the original purpose.<a href="#section-5.2.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2.2-3">Similarly to creating a fake AS, an adversary could try to introduce a new, malicious ISD. This involves the generation of its own TRC, finding core ASes to peer with, and convincing other ISDs of its legitimacy to accept the new TRC. Although this setup is not entirely impossible, it requires substantial time and effort, and may need the involvement of more than one malicious entity. Here, the "costs" of setting up the fake ISD may outweigh the benefits.<a href="#section-5.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="peer-link-misuse">
<section id="section-5.2.3">
          <h4 id="name-peering-link-misuse">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-peering-link-misuse" class="section-name selfRef">Peering Link Misuse</a>
          </h4>
<p id="section-5.2.3-1">The misuse of a peering link by an adversary represents another type of attack. Consider the case where AS A wants to share its peering link only with one of its downstream neighbors, AS B, and therefore selectively includes the peering link only in PCBs sent to B. An adversary may now try to gain access to this peering link by prepending the relevant PCBs to its own path. For this, the adversary needs to be able to (1) eavesdrop on the link from A to B, and (2) obtain the necessary hop fields by querying a control service and extracting the hop fields from registered paths.<a href="#section-5.2.3-1" class="pilcrow">¶</a></p>
<p id="section-5.2.3-2">Even if an adversary succeeds in misusing a peering link as described above, SCION is able to mitigate this kind of attack: Each AS includes an egress interface as well as specific “next hop” information to the PCB before disseminating it further downstream. If a malicious entity tries to misuse a stolen PCB by adding it to its own segments, verification will fail upstream as the egress interface mismatches. Therefore, the peering link can only be used by the intended AS.<a href="#section-5.2.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="manipulate-selection">
<section id="section-5.2.4">
          <h4 id="name-manipulation-of-the-path-se">
<a href="#section-5.2.4" class="section-number selfRef">5.2.4. </a><a href="#name-manipulation-of-the-path-se" class="section-name selfRef">Manipulation of the Path-Selection Process</a>
          </h4>
<p id="section-5.2.4-1">Endpoint path control is one of the main benefits of SCION compared to the current Internet, as SCION endpoints can select inter-domain forwarding paths for each packet. However, with the benefits of path selection comes the risk of endpoints selecting non-optimal paths. This section discusses some mechanisms with which an adversary can attempt to trick endpoints downstream (in the direction of beaconing) into choosing non-optimal paths. The goal of such attacks is to make paths that are controlled by the adversary more attractive than other available paths.<a href="#section-5.2.4-1" class="pilcrow">¶</a></p>
<p id="section-5.2.4-2">In SCION, overall path selection is the result of three steps. First, each AS selects which PCBs are further forwarded to its neighbors. Second, each AS chooses the paths it wants to register at the local control service (as up-segments) and at the core control service (as down-segments). Third, the endpoint performs path selection among all available paths resulting from a path lookup process. The following text describes attacks that aim at influencing the path-selection process.<a href="#section-5.2.4-2" class="pilcrow">¶</a></p>
<p id="section-5.2.4-3">These attacks are only successful if the adversary is located within the same ISD and upstream relative to the victim AS. It is not possible to attract traffic away from the core as traffic travels upstream towards the core. Furthermore, the attack may either be discovered downstream (e.g., by seeing large numbers of paths becoming available), or during path registrations. After detection, non-core ASes will be able to identify paths traversing the adversary AS and avoid these paths.<a href="#section-5.2.4-3" class="pilcrow">¶</a></p>
<p id="section-5.2.4-4"><strong>Announcing Large Numbers of Path Segments</strong> <br>
This attack is possible if the adversary controls multiple (at least two) ASes. The adversary can create a large number of links between the ASes under its control, which do not necessarily correspond to physical links. This allows the adversary to multiply the number of PCBs forwarded to its downstream neighbor ASes. This in turn increases the chance that one or several of these forwarded PCBs are selected by the downstream ASes.<a href="#section-5.2.4-4" class="pilcrow">¶</a></p>
<p id="section-5.2.4-5">In general, the number of PCBs that an adversary can announce this way scales exponentially with the number of consecutive ASes the adversary controls. However, this also decreases their chance of being chosen by a downstream AS for PCB dissemination or by an endpoint for path construction, as these relatively long paths have to compete with other, shorter paths. Furthermore, both endpoints and downstream ASes can detect poorer quality paths in the data plane and switch to better paths.<a href="#section-5.2.4-5" class="pilcrow">¶</a></p>
<p id="section-5.2.4-6"><strong>Wormhole Attack</strong> <br>
A malicious AS M1 can send a PCB not only to their downstream neighbor ASes, but also out-of-band to another, non-neighbor colluding malicious AS M2. This creates new segments to M2 and M2's downstream neighbor ASes, simulating a link between M1 and M2 which may not correspond to an actual link in the network topology.<a href="#section-5.2.4-6" class="pilcrow">¶</a></p>
<p id="section-5.2.4-7">Similarly, a fake path can be announced through a fake peering link between two colluding ASes, even if in different ISDs. An adversary can advertise fake peering links between the two colluding ASes, thus offering short paths to many destination ASes. Downstream ASes might have a policy of preferring paths with many peering links and thus are more likely to disseminate PCBs from the adversary. Similarly, endpoints are more likely to choose short paths that make use of peering links. In the data plane, whenever the adversary receives a packet containing a fake peering link, it can transparently exchange the fake peering hop fields with valid hop fields to the colluding AS. To avoid detection of the path alteration by the receiver, the colluding AS can replace the added hop fields with the fake peering link hop fields the sender inserted.<a href="#section-5.2.4-7" class="pilcrow">¶</a></p>
<p id="section-5.2.4-8">To defend against this attack, methods to detect the wormhole attack are needed.  Per link or path latency measurements can help reveal the wormhole and render the fake peering link suspicious or unattractive. Without specific detection mechanisms these so-called wormhole attacks are unavoidable in routing.<a href="#section-5.2.4-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="dos-cp">
<section id="section-5.3">
        <h3 id="name-denial-of-service-attacks">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-denial-of-service-attacks" class="section-name selfRef">Denial of Service Attacks</a>
        </h3>
<p id="section-5.3-1">The beaconing process in the SCION control plane relies on control-plane communication. ASes exchange control-plane messages within each other when propagating PCBs to downstream neighbors,  when registering PCBs as path segments at the core control services, or during core path lookup. Volumetric DoS attacks, where attackers overload a link, may make it difficult to exchange these messages. SCION limits the impact of volumetric DoS attacks, which aim to exhaust network bandwidth on links; in this case, ASes can switch to alternative paths that do not contain the congested links. In addition, reflection-based attacks are prevented, as thanks to path-awareness, response packets are returned on the same path to the actual sender.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">Other mechanisms are required to avoid transport protocol attacks, where the attacker tries to exhaust the resources on a target server, such as a control service server, by opening many connections to this server. Possible means to mitigate this kind of DoS attacks are basically the same as for the current Internet, e.g., filtering, geo-blocking or using cookies.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">Thanks to its path-awareness, SCION enables more fine-grained filtering mechanisms based on certain path properties. For example, control-plane RPC methods that are available to endpoints within an AS are strictly separate from methods available to endpoints from other ASes. Specifically, expensive recursive path segment and trust material lookups are thus shielded from abuse by unauthorized entities.
For RPC methods exposed to other ASes, the control service implementation minimizes its attack surface by rejecting illegitimate callers based on ISD/AS, path type and length and any other available data points as soon as possible, i.e. immediately after determining the request type. For example:<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-4.1">
            <p id="section-5.3-4.1.1"><code>SegmentCreationService.Beacon</code> can only be called by direct neighbors and thus calls from peers with a path length greater than one can immediately be discarded.<a href="#section-5.3-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.3-4.2">
            <p id="section-5.3-4.2.1"><code>SegmentRegistrationService.SegmentsRegistration</code> can only be called from within the same ISD, thus the source address <span class="bcp14">MUST</span> match the local ISD and the number of path segments <span class="bcp14">MUST</span> be 1.<a href="#section-5.3-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.3-5">A combination of the mechanism above is used to prevent flooding attacks on the control service. In addition, the control service <span class="bcp14">SHOULD</span> be deployed in a distributed and replicated manner so that requests can be balanced and a single instance failure does not result in a complete failure of the control plane of a SCION AS.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">This document has no IANA actions.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The ISD and SCION AS number are SCION-specific numbers. They are currently allocated by Anapaya Systems, a provider of SCION-based networking software and solutions (see <a href="https://docs.anapaya.net/en/latest/resources/isd-as-assignments/">Anapaya ISD AS assignments</a>). This task is currently being transitioned from Anapaya to the SCION Association.<a href="#section-6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-combined-references">
<section id="section-7">
      <h2 id="name-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-7.1">
        <h3 id="name-normative-references">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="Connect">[Connect]</dt>
        <dd>
<span class="refTitle">"Connect Protocol Reference"</span>, <time datetime="2024" class="refDate">2024</time>, <span>&lt;<a href="https://connectrpc.com/docs/protocol/">https://connectrpc.com/docs/protocol/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="gRPC">[gRPC]</dt>
        <dd>
<span class="refTitle">"gRPC, an open-source universal RPC framework"</span>, <time datetime="2023" class="refDate">2023</time>, <span>&lt;<a href="https://grpc.io/">https://grpc.io/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.scion-cppki">[I-D.scion-cppki]</dt>
        <dd>
<span class="refAuthor">de Kater, C.</span>, <span class="refAuthor">Rustignoli, N.</span>, and <span class="refAuthor">S. Hitz</span>, <span class="refTitle">"SCION Control-Plane PKI"</span>, <time datetime="2023" class="refDate">2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-dekater-scion-pki/">https://datatracker.ietf.org/doc/draft-dekater-scion-pki/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.scion-dp">[I-D.scion-dp]</dt>
        <dd>
<span class="refAuthor">de Kater, C.</span>, <span class="refAuthor">Rustignoli, N.</span>, and <span class="refAuthor">S. Hitz</span>, <span class="refTitle">"SCION Data Plane"</span>, <time datetime="2023" class="refDate">2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-dekater-scion-dataplane/">https://datatracker.ietf.org/doc/draft-dekater-scion-dataplane/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="proto3">[proto3]</dt>
        <dd>
<span class="refTitle">"Protocol Buffers Language Guide version 3"</span>, <time datetime="2023" class="refDate">2023</time>, <span>&lt;<a href="https://protobuf.dev/programming-guides/proto3/">https://protobuf.dev/programming-guides/proto3/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4632">[RFC4632]</dt>
        <dd>
<span class="refAuthor">Fuller, V.</span> and <span class="refAuthor">T. Li</span>, <span class="refTitle">"Classless Inter-domain Routing (CIDR): The Internet Address Assignment and Aggregation Plan"</span>, <span class="seriesInfo">BCP 122</span>, <span class="seriesInfo">RFC 4632</span>, <span class="seriesInfo">DOI 10.17487/RFC4632</span>, <time datetime="2006-08" class="refDate">August 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4632">https://www.rfc-editor.org/rfc/rfc4632</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
        <dd>
<span class="refAuthor">Cooper, D.</span>, <span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Boeyen, S.</span>, <span class="refAuthor">Housley, R.</span>, and <span class="refAuthor">W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5280">https://www.rfc-editor.org/rfc/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5952">[RFC5952]</dt>
        <dd>
<span class="refAuthor">Kawamura, S.</span> and <span class="refAuthor">M. Kawashima</span>, <span class="refTitle">"A Recommendation for IPv6 Address Text Representation"</span>, <span class="seriesInfo">RFC 5952</span>, <span class="seriesInfo">DOI 10.17487/RFC5952</span>, <time datetime="2010-08" class="refDate">August 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5952">https://www.rfc-editor.org/rfc/rfc5952</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9000">[RFC9000]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9000">https://www.rfc-editor.org/rfc/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9114">[RFC9114]</dt>
      <dd>
<span class="refAuthor">Bishop, M., Ed.</span>, <span class="refTitle">"HTTP/3"</span>, <span class="seriesInfo">RFC 9114</span>, <span class="seriesInfo">DOI 10.17487/RFC9114</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9114">https://www.rfc-editor.org/rfc/rfc9114</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-7.2">
        <h3 id="name-informative-references">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BollRio-2000">[BollRio-2000]</dt>
        <dd>
<span class="refAuthor">Bollobás, B.</span> and <span class="refAuthor">O. Riordan</span>, <span class="refTitle">"The diameter of a scale-free random graph"</span>, <span>n.d.</span>, <span>&lt;<a href="https://kam.mff.cuni.cz/~ksemweb/clanky/BollobasR-scale_free_random.pdf">https://kam.mff.cuni.cz/~ksemweb/clanky/BollobasR-scale_free_random.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CHUAT22">[CHUAT22]</dt>
        <dd>
<span class="refAuthor">Chuat, L.</span>, <span class="refAuthor">Legner, M.</span>, <span class="refAuthor">Basin, D.</span>, <span class="refAuthor">Hausheer, D.</span>, <span class="refAuthor">Hitz, S.</span>, <span class="refAuthor">Mueller, P.</span>, and <span class="refAuthor">A. Perrig</span>, <span class="refTitle">"The Complete Guide to SCION"</span>, <span class="seriesInfo">ISBN 978-3-031-05287-3</span>, <time datetime="2022" class="refDate">2022</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-031-05288-0">https://doi.org/10.1007/978-3-031-05288-0</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1122">[RFC1122]</dt>
        <dd>
<span class="refAuthor">Braden, R., Ed.</span>, <span class="refTitle">"Requirements for Internet Hosts - Communication Layers"</span>, <span class="seriesInfo">STD 3</span>, <span class="seriesInfo">RFC 1122</span>, <span class="seriesInfo">DOI 10.17487/RFC1122</span>, <time datetime="1989-10" class="refDate">October 1989</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc1122">https://www.rfc-editor.org/rfc/rfc1122</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5398">[RFC5398]</dt>
        <dd>
<span class="refAuthor">Huston, G.</span>, <span class="refTitle">"Autonomous System (AS) Number Reservation for Documentation Use"</span>, <span class="seriesInfo">RFC 5398</span>, <span class="seriesInfo">DOI 10.17487/RFC5398</span>, <time datetime="2008-12" class="refDate">December 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5398">https://www.rfc-editor.org/rfc/rfc5398</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6996">[RFC6996]</dt>
        <dd>
<span class="refAuthor">Mitchell, J.</span>, <span class="refTitle">"Autonomous System (AS) Reservation for Private Use"</span>, <span class="seriesInfo">BCP 6</span>, <span class="seriesInfo">RFC 6996</span>, <span class="seriesInfo">DOI 10.17487/RFC6996</span>, <time datetime="2013-07" class="refDate">July 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6996">https://www.rfc-editor.org/rfc/rfc6996</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9217">[RFC9217]</dt>
        <dd>
<span class="refAuthor">Trammell, B.</span>, <span class="refTitle">"Current Open Questions in Path-Aware Networking"</span>, <span class="seriesInfo">RFC 9217</span>, <span class="seriesInfo">DOI 10.17487/RFC9217</span>, <time datetime="2022-03" class="refDate">March 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9217">https://www.rfc-editor.org/rfc/rfc9217</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9473">[RFC9473]</dt>
      <dd>
<span class="refAuthor">Enghardt, R.</span> and <span class="refAuthor">C. Krähenbühl</span>, <span class="refTitle">"A Vocabulary of Path Properties"</span>, <span class="seriesInfo">RFC 9473</span>, <span class="seriesInfo">DOI 10.17487/RFC9473</span>, <time datetime="2023-09" class="refDate">September 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9473">https://www.rfc-editor.org/rfc/rfc9473</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">Many thanks go to William Boye (Swiss National Bank), Matthias Frei (SCION Association), Kevin Meynell (SCION Association), Juan A. Garcia Prado (ETH Zurich), and Roger Lapuh (Extreme Networks) for reviewing this document. We are also very grateful to Adrian Perrig (ETH Zurich), for providing guidance and feedback about each aspect of SCION. Finally, we are indebted to the SCION development teams of Anapaya and ETH Zurich, for their practical knowledge and for the documentation about the SCION Control Plane, as well as to the authors of <span>[<a href="#CHUAT22" class="cite xref">CHUAT22</a>]</span> - the book is an important source of input and inspiration for this draft.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="app-a">
<section id="appendix-B">
      <h2 id="name-control-service-grpc-api">
<a href="#name-control-service-grpc-api" class="section-name selfRef">Control Service gRPC API</a>
      </h2>
<p id="appendix-B-1">The following code block provides, in protobuf format, the API by which control services interract.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<span id="name-control-service-grpc-api-de"></span><div id="_figure-11">
<figure id="figure-10">
        <div class="alignLeft art-text artwork" id="appendix-B-2.1">
<pre>
enum SegmentType {
    // Unknown segemnt type.
    SEGMENT_TYPE_UNSPECIFIED = 0;
    // Up segment.
    SEGMENT_TYPE_UP = 1;
    // Down segment.
    SEGMENT_TYPE_DOWN = 2;
    // Core segment.
    SEGMENT_TYPE_CORE = 3;
}


// This API is exposed by the control services of core ASes expose this on the SCION dataplane and also by all
// control services on the "intra-domain protocol" network.
service SegmentLookupService {
    // Segments returns all segments that match the request.
    rpc Segments(SegmentsRequest) returns (SegmentsResponse) {}
}

message SegmentsRequest {
    // The source ISD-AS of the segment.
    uint64 src_isd_as = 1;
    // The destination ISD-AS of the segment.
    uint64 dst_isd_as = 2;
}

message SegmentsResponse {
    message Segments {
        // List of path segments.
        repeated PathSegment segments = 1;
    }

    // Mapping from path segment type to path segments.
    // The key is the integer
    // representation of the SegmentType enum.
    map&lt;int32, Segments&gt; segments = 1;
}

// This API is only exposed by core ASes and only on the SCION dataplane.
service SegmentRegistrationService {
    // SegmentsRegistration registers segments at the remote.
    rpc SegmentsRegistration(SegmentsRegistrationRequest) returns (
        SegmentsRegistrationResponse) {}
}

message SegmentsRegistrationRequest {
    message Segments {
        // List of path segments.
        repeated PathSegment segments = 1;
    }

    // Mapping from path segment type to path segments.
    // The key is the integer
    // representation of the SegmentType enum.
    map&lt;int32, Segments&gt; segments = 1;
}

message SegmentsRegistrationResponse {}

service SegmentCreationService {
    // Beacon sends a beacon to the remote.
    rpc Beacon(BeaconRequest) returns (BeaconResponse) {}
}

message BeaconRequest {
    // Beacon in form of a partial path segment.
    PathSegment segment = 1;
}

message BeaconResponse {}

message PathSegment {
    // The encoded SegmentInformation. It is used for signature input.
    bytes segment_info = 1;
    // Entries of ASes on the path.
    repeated ASEntry as_entries = 2;
}

message SegmentInformation {
    // Segment creation time set by the originating AS. Segment
    // expiration time is computed relative to this timestamp.
    // The timestamp is encoded as the number of seconds elapsed
    // since January 1, 1970 UTC.
    int64 timestamp = 1;
    // The 16-bit segment ID integer used for MAC computation.
    uint32 segment_id = 2;
}

message ASEntry {
    // The signed part of the AS entry. The body of the SignedMessage
    // is the serialized ASEntrySignedBody. The signature input is
    // defined as follows:
    //
    //  input(ps, i) = signed.header_and_body || associated_data(ps, i)
    //
    //  associated_data(ps, i) =
    //          ps.segment_info ||
    //          ps.as_entries[1].signed.header_and_body ||
    //          ps.as_entries[1].signed.signature ||
    //          ...
    //          ps.as_entries[i-1].signed.header_and_body ||
    //          ps.as_entries[i-1].signed.signature
    //
    proto.crypto.v1.SignedMessage signed = 1;
    // The unsigned part of the AS entry.
    proto.control_plane.v1.PathSegmentUnsignedExtensions unsigned = 2;
}

message ASEntrySignedBody {
    // ISD-AS of the AS that created this AS entry.
    uint64 isd_as = 1;
    // ISD-AS of the downstream AS.
    uint64 next_isd_as = 2;
    // The required regular hop entry.
    HopEntry hop_entry = 3;
    // Optional peer entries.
    repeated PeerEntry peer_entries = 4;
    // Intra AS MTU.
    uint32 mtu = 5;
    // Optional extensions.
    proto.control_plane.v1.PathSegmentExtensions extensions = 6;
}

message HopEntry {
    // Material to create the data-plane hop field.
    HopField hop_field = 1;
    // MTU on the ingress link.
    uint32 ingress_mtu = 2;
}

message PeerEntry {
    // ISD-AS of peer AS. This is used to match peering segments during
    // path construction.
    uint64 peer_isd_as = 1;
    // Remote peer interface identifier. This is used to match
    // peering segments
    // during path construction.
    uint64 peer_interface = 2;
    // MTU on the peering link.
    uint32 peer_mtu = 3;
    // Material to create the data-plane hop field
    HopField hop_field = 4;
}

message HopField {
    // Ingress interface identifier.
    uint64 ingress = 1;
    // Egress interface identifier.
    uint64 egress = 2;
    // 8-bit encoded expiration offset relative to the segment creation
    // timestamp.
    uint32 exp_time = 3;
    // MAC used in the dataplane to verify the hop field.
    bytes mac = 4;
}

enum SignatureAlgorithm {
    // Unspecified signature algorithm. This value is never valid.
    SIGNATURE_ALGORITHM_UNSPECIFIED = 0;
    // ECDS with SHA256.
    SIGNATURE_ALGORITHM_ECDSA_WITH_SHA256 = 1;
    // ECDS with SHA384.
    SIGNATURE_ALGORITHM_ECDSA_WITH_SHA384 = 2;
    // ECDS with SHA512.
    SIGNATURE_ALGORITHM_ECDSA_WITH_SHA512 = 3;
}

message SignedMessage {
    // Encoded header and body.
    bytes header_and_body = 1;
    // Raw signature. The signature is computed over the concatenation
    // of the header and body, and the optional associated data.
    bytes signature = 2;
}

message Header {
    // Algorithm used to compute the signature.
    SignatureAlgorithm signature_algorithm = 1;
    // Optional arbitrary per-protocol key identifier.
    bytes verification_key_id = 2;
    // Optional signature creation timestamp.
    google.protobuf.Timestamp timestamp = 3;
    // Optional arbitrary per-protocol metadata.
    bytes metadata = 4;
    // Length of associated data that is covered by the signature, but
    // is not included in the header and body. This is zero, if no
    // associated data is covered by the signature.
    int32 associated_data_length = 5;
}

// Low-level representation of HeaderAndBody used for signature
// computation input. This should not be used by external code.
message HeaderAndBodyInternal {
    // Enocded header suitable for signature computation.
    bytes header = 1;
    // Raw payload suitable for signature computation.
    bytes body = 2;
}

message VerificationKeyID {
    uint64 isd_as = 1;
    bytes subject_key_id = 2;
    uint64 trc_base = 3;
    uint64 trc_serial = 4;
}

</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-control-service-grpc-api-de" class="selfRef">Control Service gRPC API definition</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="app-b">
<section id="appendix-C">
      <h2 id="name-scion-data-plane-use-by-the">
<a href="#name-scion-data-plane-use-by-the" class="section-name selfRef">SCION data plane use by the SCION control plane</a>
      </h2>
<p id="appendix-C-1">The SCION control plane RPC APIs rely on QUIC connections carried by the SCION dataplane. The main difference between QUIC over native UDP and QUIC over UDP/SCION is the need for a UDP/SCION connection initiator to identify the relevant peer (service resolution) and to select a path to it. Since the control service is itself the source of path segment information, the following bootstraping strategies apply:<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-2.1">
          <p id="appendix-C-2.1.1">Neighboring ASes craft one-hop-paths directly. This allows multihop paths to be constructed and propagated incrementally.<a href="#appendix-C-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.2">
          <p id="appendix-C-2.2.1">Constructed multihop paths are registered with the control service at the origin core AS. The path to that AS is the very path being
registered.<a href="#appendix-C-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.3">
          <p id="appendix-C-2.3.1">Paths to far ASes are available from neighboring ASes. Clients obtain paths to remote ASes from their local control service.<a href="#appendix-C-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.4">
          <p id="appendix-C-2.4.1">Control services respond to requests from remote ASes by reversing the path via which the request came.<a href="#appendix-C-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.5">
          <p id="appendix-C-2.5.1">Clients find the relevant control service endpoint by resolving a "service address" (that is an address where the <code>DT/DL</code> field of the common header is set to 1/0 (see <span>[<a href="#I-D.scion-dp" class="cite xref">I-D.scion-dp</a>]</span>).<a href="#appendix-C-2.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-C-3">The mechanics of service address resolution are the following:<a href="#appendix-C-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-4.1">
          <p id="appendix-C-4.1.1">To resolve the address of the control service at a given AS, a client sends a ServiceResolutionRequest RPC (which has no parameters) to an enpoint address constructed as follows:<a href="#appendix-C-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-4.1.2.1">
              <p id="appendix-C-4.1.2.1.1">Common Header:<a href="#appendix-C-4.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-4.1.2.1.2.1">
                  <p id="appendix-C-4.1.2.1.2.1.1">Path type: SCION (0x01)<a href="#appendix-C-4.1.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-C-4.1.2.1.2.2">
                  <p id="appendix-C-4.1.2.1.2.2.1">DT/DL: "Service" (0b0100)<a href="#appendix-C-4.1.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="appendix-C-4.1.2.2">
              <p id="appendix-C-4.1.2.2.1">Address Header:<a href="#appendix-C-4.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-4.1.2.2.2.1">
                  <p id="appendix-C-4.1.2.2.2.1.1">DstHostAddr: "SVC_CS" (0x0002)<a href="#appendix-C-4.1.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="appendix-C-4.1.2.3">
              <p id="appendix-C-4.1.2.3.1">UDP Header:<a href="#appendix-C-4.1.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-4.1.2.3.2.1">
                  <p id="appendix-C-4.1.2.3.2.1.1">DstPort: 0<a href="#appendix-C-4.1.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-C-4.2">
          <p id="appendix-C-4.2.1">The ingress border router at the destination AS resolves the service destination to an actual endpoint address. This document does not mandate any specific method for this resolution.<a href="#appendix-C-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-4.3">
          <p id="appendix-C-4.3.1">The ingress border router forwards the message to the resolved address.<a href="#appendix-C-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-4.4">
          <p id="appendix-C-4.4.1">The destination service responds to the client with a ServiceResolutionResponse. That response contain one or more transport options.<a href="#appendix-C-4.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-4.5">
          <p id="appendix-C-4.5.1">The client uses the address and port from the "QUIC" option to establish a QUIC connection, which can then be used for regular RPCs.<a href="#appendix-C-4.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-C-5">The following code block provides the full service resolution API in the Protobuf message format.<a href="#appendix-C-5" class="pilcrow">¶</a></p>
<span id="name-service-resolution-grpc-api"></span><div id="_figure-12">
<figure id="figure-11">
        <div class="alignLeft art-text artwork" id="appendix-C-6.1">
<pre>
package proto.control_plane.v1;

// A ServiceResolutionRequest must always fit within a UDP datagram. If
// the request does not fit, there is no mechanism for clients and
// servers to establish control-plane reachability.
message ServiceResolutionRequest {}

// A ServiceResolutionResponse must always fit within a UDP datagram. If
// the response does not fit, there is no mechanism for clients and
// servers to establish control-plane reachability.
message ServiceResolutionResponse {
    // Supported transports to reach the service,
    //
    // List of known transports:
    // - QUIC
    //
    // Unknown values should be ignored by clients.
    map&lt;string, Transport&gt; transports = 1;
}

message Transport {
    // Protocol specific server address descriptor.
    //
    // Supported address format for QUIC:
    //  192.168.0.1:80
    //  [2001:db8::1]:80
    //
    //  Missing ports / zero port / invalid port values should be
    // treated by clients as errors.
    string address = 1;
}

</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-service-resolution-grpc-api" class="selfRef">Service Resolution gRPC API definition</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="app-c">
<section id="appendix-D">
      <h2 id="name-path-lookup-examples">
<a href="#name-path-lookup-examples" class="section-name selfRef">Path-Lookup Examples</a>
      </h2>
<p id="appendix-D-1">To illustrate how the path lookup works, we show two path-lookup examples in sequence diagrams. The network topology of the examples is represented in <a href="#_figure-8" class="auto internal xref">Figure 12</a> below. In both examples, the source endpoint is in AS A. <a href="#_figure-9" class="auto internal xref">Figure 13</a> shows the sequence diagram for the path lookup process in case the destination is in AS D, whereas <a href="#_figure-10" class="auto internal xref">Figure 14</a> shows the path lookup sequence diagram if the destination is in AS G. ASes B and C are core ASes in the source ISD, while E and F are core ASes in a remote ISD. Core AS B is a provider of the local AS, but AS C is not, i.e., there is no up-segment from A to C. "CS" stands for controle service.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<span id="name-topology-used-in-the-path-l"></span><div id="_figure-8">
<figure id="figure-12">
        <div class="alignLeft art-text artwork" id="appendix-D-2.1">
<pre>
+----------------------------+     +----------------------------+
|                            |     |                            |
|                            |     |                            |
|    +------------------+    |     |    +------------------+    |
|    |      Core        |    |     |    |          Core    |    |
|    |                  |    |     |    |                  |    |
|    | .---.     .---.  |    |     |    |            .---. |    |
|    |(  C  )---(  B  )-----------------------------(  F  )|    |
|    | `+--'     `+-+'---------+   |    |    .---.   `+-+' |    |
|    |  |         | |   |    | +------------(  E  )   | |  |    |
|    |  |         | |   |    |     |    |    `-+-'----+ |  |    |
|    +--|---------|-|---+    |     |    +------|--------|--+    |
|       |         | |        |     |           |        |       |
|       |         | |        |     |           |        |       |
|       |+--------+ |        |     |           |        |       |
|       ||          |        |     |           |        |       |
|       ||          |        |     |           |        |       |
|     .-++.         |        |     |         .-+-.      |       |
|    (  D  )      .-+-.      |     |        (  G  )-----+       |
|     `---'      (  A  )     |     |         `---'              |
|                 `---'      |     |                            |
|   ISD 1                    |     |                    ISD 2   |
+----------------------------+     +----------------------------+
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-topology-used-in-the-path-l" class="selfRef">Topology used in the path lookup examples.</a>
        </figcaption></figure>
</div>
<span id="name-sequence-diagram-illustrati"></span><div id="_figure-9">
<figure id="figure-13">
        <div class="alignLeft art-text artwork" id="appendix-D-3.1">
<pre>
+---------+          +---------+          +---------+        +---------+
|Endpoint |          |Source AS|          | Core AS |        | Core AS |
|         |          | CS (A)  |          | CS (B)  |        | CS (C)  |
+----+----+          +----+----+          +----+----+        +-----+---+
    +++                   |                    |                   |
    | |                   |                    |                   |
+---+-+-------+           |                    |                   |
|send requests|           |                    |                   |
| in parallel |           |                    |                   |
+---+-+-------+           |                    |                   |
    | |                   |                    |                   |
    | |  request (up)     |                    |                   |
    | +-----------------&gt;+++                   |                   |
    | |&lt; -- -- -- -- -- -+++                   |                   |
    | | reply (up,[A-&gt;B]) |                    |                   |
    | |                   |                    |                   |
    | |                   |                    |                   |
    | |                   |                    |                   |
    | |request (core,*,*) |                    |                   |
    | +-----------------&gt;+++                   |                   |
    | |                  | |request (core,B,*) |                   |
    | |                  | +-----------------&gt;+++                  |
    | |                  | |&lt;-- -- -- -- -- --+++                  |
    | |                  | | reply(core,[B-&gt;C])|                   |
    | |&lt; -- -- -- -- -- -+++                   |                   |
    | |reply (core,[B-&gt;C])|                    |                   |
    | |                   |                    |                   |
    | |                   |                    |                   |
    | |request (down,*,D) |                    |                   |
    | +-----------------&gt;+++                   |                   |
    | |            +-----+-+-----+             |                   |
    | |            |send requests|             |                   |
    | |            | in parallel |             |                   |
    | |            +-----+-+-----+             |                   |
    | |                  | |                   |                   |
    | |                  | |request (down,B,D) |                   |
    | |                  | +-----------------&gt;+++                  |
    | |                  | |&lt;-- -- -- -- -- --+++                  |
    | |                  | | reply(down,[B-&gt;D])|                   |
    | |                  | |                   |                   |
    | |                  | |                   |request (down,C,D) |
    | |                  | +-------------------+-----------------&gt;+++
    | |                  | &lt;-- -- -- -- -- -- -+ -- -- -- -- -- --+++
    | |   reply (down,   | |                   | reply(down,[C-&gt;D])|
    | |   [B-&gt;D, C-&gt;D])  | |                   |                   |
    | |&lt; -- -- -- -- -- -+++                   |                   |
    | |                   |                    |                   |
+---+-+----------+        |                    |                   |
|combine segments|        |                    |                   |
+---+-+----------+        |                    |                   |
    | |                   |                    |                   |
    +++                   |                    |                   |
     |                    |                    |                   |
 +---+----+           +---+----+          +----+---+          +----+---+
 +--------+           +--------+          +--------+          +--------+
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-sequence-diagram-illustrati" class="selfRef">Sequence diagram illustrating a path lookup for a destination D in the source ISD. The request (core, x, x) is for all pairs of core ASes in the source ISD. Similarly, (down, x, D) is for down-segments between any core AS in the source ISD and destination D.</a>
        </figcaption></figure>
</div>
<span id="name-sequence-diagram-illustratin"></span><div id="_figure-10">
<figure id="figure-14">
        <div class="alignLeft art-text artwork" id="appendix-D-4.1">
<pre>
+---------+     +---------+      +---------+   +---------+   +---------+
|Endpoint |     |Source AS|      | Core AS |   | Core AS |   | Core AS |
|         |     | CS (A)  |      | CS (B)  |   | CS (E)  |   | CS (F)  |
+---+-----+     +----+----+      +----+----+   +----+----+   +----+----+
    |                |                |             |             |
   +++               |                |             |             |
   | |               |                |             |             |
+--+-+------+        |                |             |             |
|   send    |        |                |             |             |
|requests in|        |                |             |             |
| parallel  |        |                |             |             |
+--+-+------+        |                |             |             |
   | |               |                |             |             |
   | |  request (up) |                |             |             |
   | +-------------&gt;+++               |             |             |
   | |&lt;- -- -- -- --+++               |             |             |
   | |    reply      |                |             |             |
   | | (up,[A-&gt;B])   |                |             |             |
   | |               |                |             |             |
   | |               |                |             |             |
   | |   request     |                |             |             |
   | |(core,*,(2,*)) |                |             |             |
   | +-------------&gt;+++    request    |             |             |
   | |              | |(core,B,(2,*)) |             |             |
   | |              | +-------------&gt;+++            |             |
   | |              | |&lt;- -- -- -- --+++            |             |
   | |              | | reply (core,  |             |             |
   | |              | | [B-&gt;E,B-&gt;F])  |             |             |
   | |&lt;- -- -- -- --+++               |             |             |
   | | reply (core,  |                |             |             |
   | | [B-&gt;E,B-&gt;F])  |                |             |             |
   | |               |                |             |             |
   | |               |                |             |             |
   | |               |                |             |             |
   | |   request     |                |             |             |
   | |(down,(2,*),G) |                |             |             |
   | +-------------&gt;+++               |             |             |
   | |        +-----+-+-----+         |             |             |
   | |        |send requests|         |             |             |
   | |        | in parallel |         |             |             |
   | |        +-----+-+-----+         |   request   |             |
   | |              | |               | (down,E,G)  |             |
   | |              | +---------------+-----------&gt;+++            |
   | |              | &lt;- -- -- -- -- -+ -- -- -- --+++            |
   | |              | |               |    reply    |             |
   | |              | |               |(down,[E-&gt;G])|             |
   | |              | |               |             |   request   |
   | |              | |               |             | (down,F,G)  |
   | |              | +---------------+-------------+-----------&gt;+++
   | |              | &lt; -- -- -- -- --|-- -- -- -- -+ -- -- -- --+++
   | |              | |               |             |    reply    |
   | | reply (down, | |               |             |(down,[F-&gt;G])|
   | | [E-&gt;G,F-&gt;G]) | |               |             |             |
   | |&lt;- -- -- -- --+++               |             |             |
   | |               |                |             |             |
+--+-+----+          |                |             |             |
| combine |          |                |             |             |
|segments |          |                |             |             |
+--+-+----+          |                |             |             |
   | |               |                |             |             |
   +++               |                |             |             |
    |                |                |             |             |
+---+----+       +---+----+       +---+----+    +---+----+    +---+----+
+--------+       +--------+       +--------+    +--------+    +--------+
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-sequence-diagram-illustratin" class="selfRef">Sequence diagram illustrating a path lookup for a destination G in a remote ISD. The request (core, x, (2, x)) is for all path segments between a core AS in the source ISD and a core AS in ISD 2. Similarly, (down, (2, x), G) is for down-segments between any core AS in ISD 2 and destination G.</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-E">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Corine de Kater</span></div>
<div dir="auto" class="left"><span class="org">SCION Association</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:c_de_kater@gmx.ch" class="email">c_de_kater@gmx.ch</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Nicola Rustignoli</span></div>
<div dir="auto" class="left"><span class="org">SCION Association</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:nic@scion.org" class="email">nic@scion.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Samuel Hitz</span></div>
<div dir="auto" class="left"><span class="org">Anapaya Systems</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:hitz@anapaya.net" class="email">hitz@anapaya.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
